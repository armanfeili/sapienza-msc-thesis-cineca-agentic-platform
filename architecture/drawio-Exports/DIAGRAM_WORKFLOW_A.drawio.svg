<?xml version="1.0" encoding="UTF-8"?>
<!-- Do not edit this file with editors other than draw.io -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" style="background: #ffffff; background-color: light-dark(#ffffff, #121212); color-scheme: light dark;" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="1581px" height="3021px" viewBox="0 0 1581 3021" content="&lt;mxfile host=&quot;app.diagrams.net&quot; agent=&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36&quot; version=&quot;29.3.4&quot; scale=&quot;1&quot; border=&quot;0&quot;&gt;&#10;  &lt;diagram name=&quot;Page-1&quot; id=&quot;o7U-nxtfvU7QnVVJ9hKv&quot;&gt;&#10;    &lt;mxGraphModel dx=&quot;4744&quot; dy=&quot;2864&quot; grid=&quot;1&quot; gridSize=&quot;10&quot; guides=&quot;1&quot; tooltips=&quot;1&quot; connect=&quot;1&quot; arrows=&quot;1&quot; fold=&quot;1&quot; page=&quot;1&quot; pageScale=&quot;1&quot; pageWidth=&quot;850&quot; pageHeight=&quot;1100&quot; background=&quot;#ffffff&quot; math=&quot;0&quot; shadow=&quot;0&quot;&gt;&#10;      &lt;root&gt;&#10;        &lt;mxCell id=&quot;0&quot; /&gt;&#10;        &lt;mxCell id=&quot;1&quot; parent=&quot;0&quot; /&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-1&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;-zAXcNhFpfNaQYtVMxQg-2&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;&quot; target=&quot;-zAXcNhFpfNaQYtVMxQg-22&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-2&quot; parent=&quot;1&quot; style=&quot;swimlane;whiteSpace=wrap;html=1;startSize=40;fillColor=#E0DDEF;&quot; value=&quot;&amp;lt;div&amp;gt;IDENTITY &amp;amp;amp; AUTHENTICATION LAYER:&amp;amp;nbsp;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;CLIENTS &amp;amp;amp; USER INTERFACES&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;540&quot; width=&quot;570&quot; x=&quot;70&quot; y=&quot;130&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxRectangle height=&quot;30&quot; width=&quot;140&quot; x=&quot;470&quot; y=&quot;210&quot; as=&quot;alternateBounds&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-3&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-2&quot; style=&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;fillColor=#F3F0FF;&quot; value=&quot;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;b&amp;gt;Identity Provider (OIDC / Auth0)&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;160&quot; width=&quot;550&quot; x=&quot;10&quot; y=&quot;50&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-4&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-3&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;&quot; value=&quot;&amp;lt;div&amp;gt;- OAuth 2.0 login flow&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- JWT tokens (tenant_id, sub, roles[], scopes[], exp, iat)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- JWKS endpoint for token verification&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Token refresh &amp;amp;amp; revocation&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Principal:&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;sub, tenant_id,&amp;amp;nbsp;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;roles: [admin, operator, user, viewer],&amp;amp;nbsp;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;scopes: [read, write, graph:read, ...]&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;130&quot; width=&quot;550&quot; y=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-5&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-2&quot; style=&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#F3F0FF;&quot; value=&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;Agent Chat UI (Next.js / React)&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;210&quot; width=&quot;550&quot; x=&quot;10&quot; y=&quot;220&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-6&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-5&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;&quot; value=&quot;&amp;lt;div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br class=&amp;quot;Apple-interchange-newline&amp;quot;&amp;gt;[AGENT RUN - WORKFLOW A]&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- End user chat interface&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- JWT-based authentication&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- SSE Streaming support&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Agent runs &amp;amp;amp; steps display&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Real-time polling for updates&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;div style=&amp;quot;font-size: 11px; text-wrap-mode: nowrap;&amp;quot;&amp;gt;POST /v1/agent-runs&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;font-size: 11px; text-wrap-mode: nowrap;&amp;quot;&amp;gt;- Bearer JWT, prompt, model, temperature&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;font-size: 11px; text-wrap-mode: nowrap;&amp;quot;&amp;gt;- Returns: {run_id, status: &amp;quot;queued&amp;quot;}&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;180&quot; width=&quot;550&quot; y=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-7&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-2&quot; style=&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#F3F0FF;&quot; value=&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;Reverse Proxy / API Gateway (NGINX)&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;90&quot; width=&quot;550&quot; x=&quot;10&quot; y=&quot;440&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-8&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-7&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;&quot; value=&quot;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;-&amp;amp;nbsp;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent;&amp;quot;&amp;gt;TLS termination (HTTPS)&amp;amp;nbsp;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Routing to backend services&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- CORS handling&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;-&amp;amp;nbsp;Load balancing&amp;amp;nbsp;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;60&quot; width=&quot;550&quot; y=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-9&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;-zAXcNhFpfNaQYtVMxQg-10&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;&quot; target=&quot;-zAXcNhFpfNaQYtVMxQg-13&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-10&quot; parent=&quot;1&quot; style=&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#D7E4D7;&quot; value=&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;API LAYER (Routers)&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;240&quot; width=&quot;570&quot; x=&quot;70&quot; y=&quot;750&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-11&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-10&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;&quot; value=&quot;&amp;lt;div&amp;gt;- /v1/health&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Health probes (live, ready, startup, components)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- /v1/auth&amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Token introspection, identity verification&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- /v1/agents&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;- Agent definitions and configurations&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- /v1/agent-runs - Agent run lifecycle (create, poll, cancel)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- /v1/tools&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- MCP tool registry and invocation&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- /v1/jobs&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Async job lifecycle (create, stream, cancel)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- /v1/models&amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Model and provider management&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- /v1/admin&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Administrative operations&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- /v1/tenants&amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Multi-tenant configuration&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- /v1/sessions&amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Session management&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- /v1/graph&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Graph query endpoints&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- /v1/batch&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Batch operations&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- /v1/export&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Data export utilities&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- /v1/internal&amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Internal diagnostics&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;210&quot; width=&quot;570&quot; y=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-12&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;-zAXcNhFpfNaQYtVMxQg-13&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;&quot; target=&quot;-zAXcNhFpfNaQYtVMxQg-16&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-13&quot; parent=&quot;1&quot; style=&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#EAF7EA;&quot; value=&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;[AGENT RUN ENDPOINTS]&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;100&quot; width=&quot;570&quot; x=&quot;70&quot; y=&quot;1070&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-14&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-13&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;&quot; value=&quot;&amp;lt;div&amp;gt;- POST /v1/agent-runs (use_jobs=false → BackgroundTasks)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- POST /v1/agent-runs?use_jobs=true (→ Jobs Worker)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- GET /v1/agent-runs/{id} (ETag support for caching)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- GET /v1/agent-runs/{id}/steps&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;70&quot; width=&quot;570&quot; y=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-15&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;-zAXcNhFpfNaQYtVMxQg-16&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;&quot; target=&quot;-zAXcNhFpfNaQYtVMxQg-42&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-16&quot; parent=&quot;1&quot; style=&quot;swimlane;whiteSpace=wrap;html=1;fillColor=#EBDFBC;&quot; value=&quot;&amp;lt;div&amp;gt;SERVICE LAYER&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;700&quot; width=&quot;570&quot; x=&quot;70&quot; y=&quot;1220&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-17&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-16&quot; style=&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#FFF2CC;&quot; value=&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;b&amp;gt;ORCHESTRATOR&amp;amp;nbsp;&amp;lt;/b&amp;gt;&amp;lt;b&amp;gt;SERVICE&amp;lt;/b&amp;gt;&amp;lt;b&amp;gt;: 1 Run per prompt,&amp;amp;nbsp;&amp;lt;/b&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; text-align: center;&amp;quot;&amp;gt;&amp;lt;b&amp;gt;4 Phases&amp;lt;/b&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;500&quot; width=&quot;550&quot; x=&quot;10&quot; y=&quot;40&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-18&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-17&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;&quot; value=&quot;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;PHASE 1) INTENT CLASSIFICATION:&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- A&amp;lt;span style=&amp;quot;background-color: transparent;&amp;quot;&amp;gt;nalyzes prompt via LLM&amp;lt;br&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent;&amp;quot;&amp;gt;- Check params.category → Match prompt catalog → Apply classify_intent()&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;:&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - CHAT - Conversational responses&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - GRAPH - Analytics, NL-&amp;amp;gt;Cypher queries&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - SECURITY - Security/permissions questions&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - ADMIN - Administrative write operations&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - DANGEROUS - Destructive ops → refuse + offer EXPLAIN&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - EXPLAIN - EXPLAIN-only query analysis&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent;&amp;quot;&amp;gt;&amp;lt;b&amp;gt;PHASE 2) TODO Planning&amp;lt;/b&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;b&amp;gt;&amp;amp;nbsp;(multi-step run):&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;- LLM-based planning&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;- Input: Goal + Context + Schema → Output: TODO Array&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;- Planning Modes: full (LLM per TODO) | optional (try direct) | none (deterministic)&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;PHASE 3) Step Execution,&amp;amp;nbsp;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;FOR EACH TODO&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;:&amp;lt;/span&amp;gt;&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; 1. Call LLM Provider (planner, reflector, responder)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; 2. Invoke MCP Tools with RBAC check (34 tools available)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; 3. If GRAPH mode: NL-&amp;amp;gt;Cypher pipeline&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; 4. Persist step → PostgreSQL&amp;amp;nbsp;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;(via adaptor)&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; 5. Use Redis for session/cache/cancel&amp;amp;nbsp;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;(via adaptor)&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Step records: {id, action, input, output, latency_ms, started_at, finished_at}&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;PHASE 4)&amp;amp;nbsp;&amp;lt;/b&amp;gt;&amp;lt;b style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;Finalization &amp;amp;amp;&amp;amp;nbsp;&amp;lt;/b&amp;gt;&amp;lt;b style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;Response Generation&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;div&amp;gt;- build_response() → Orchestration Result&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Response mode selection: fallback-only | llm-best-effort&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Canonical output structure: {goal, steps[], outputs[], todos[], metrics}&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Normalize final output: text + optional JSON payload&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Safety/compliance: PII scrubbing + output guard checks&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Persist final state + metrics → PostgreSQL&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Observability: emit Prometheus metrics + OpenTelemetry traces&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;470&quot; width=&quot;550&quot; y=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-19&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-16&quot; style=&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#FFF2CC;&quot; value=&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;b&amp;gt;ADDITIONAL SERVICES&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;120&quot; width=&quot;550&quot; x=&quot;10&quot; y=&quot;560&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-20&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-19&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;&quot; value=&quot;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;- Session Service (state management)&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Job Service (job lifecycle)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Default Model Resolver&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Health / ETL / Archive Services&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Invocation Store (audit trail)&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;90&quot; width=&quot;550&quot; y=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-21&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;-zAXcNhFpfNaQYtVMxQg-22&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.75;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;&quot; target=&quot;-zAXcNhFpfNaQYtVMxQg-11&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-22&quot; parent=&quot;1&quot; style=&quot;swimlane;whiteSpace=wrap;html=1;fillColor=#EAD6D6;&quot; value=&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;b&amp;gt;SECURITY&amp;amp;nbsp;&amp;lt;/b&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; text-align: center;&amp;quot;&amp;gt;MIDDLEWARE STACK&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;1050&quot; width=&quot;930&quot; x=&quot;720&quot; y=&quot;130&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-23&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-22&quot; style=&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;fillColor=#FFE9E9;&quot; value=&quot;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;1. CORS Handler - Cross-Origin Resource Sharing policy enforcement&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;90&quot; width=&quot;910&quot; x=&quot;10&quot; y=&quot;40&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-24&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-23&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;&quot; value=&quot;&amp;lt;div&amp;gt;- Allowed origins, methods, headers configuration&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Preflight OPTIONS request handling&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Credentials and expose headers support&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;60&quot; width=&quot;910&quot; y=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-25&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-22&quot; style=&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;fillColor=#FFE9E9;&quot; value=&quot;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;2. Trace Context - OpenTelemetry distributed tracing context&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;90&quot; width=&quot;910&quot; x=&quot;10&quot; y=&quot;140&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-26&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-25&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;&quot; value=&quot;&amp;lt;div&amp;gt;- Injects/extracts W3C trace-context headers (traceparent, tracestate)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Creates root span if missing, propagates existing trace&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Adds trace_id, span_id, parent_id to request context&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;60&quot; width=&quot;910&quot; y=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-27&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-22&quot; style=&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;fillColor=#FFE9E9;&quot; value=&quot;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;3. Auth JWT - JWT/OIDC token validation and principal extraction&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;110&quot; width=&quot;910&quot; x=&quot;10&quot; y=&quot;240&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-28&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-27&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;&quot; value=&quot;&amp;lt;div&amp;gt;- Validates Bearer token via JWKS endpoint (RS256/RS384/RS512)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Extracts claims: sub, tenant_id, roles[], scopes[], exp, iat&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;div&amp;gt;- RBAC &amp;amp;amp; Scope Enforcement for endpoints&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Builds Principal object for downstream authorization&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp;- Rejects expired/invalid/malformed tokens with 401 Unauthorized&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;80&quot; width=&quot;910&quot; y=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-29&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-22&quot; style=&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;fillColor=#FFE9E9;&quot; value=&quot;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;4. Rate Limit - Redis-backed rate limiting with multiple dimensions&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;110&quot; width=&quot;910&quot; x=&quot;10&quot; y=&quot;470&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-30&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-29&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;&quot; value=&quot;&amp;lt;div&amp;gt;- Per-user limits: ratelimit:user:{sub}&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Per-tenant limits: ratelimit:tenant:{tenant_id}&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Per-endpoint limits: ratelimit:endpoint:{method}:{path}&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp;- Sliding window algorithm, returns 429 Too Many Requests when exceeded&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp;- X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Reset headers&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;80&quot; width=&quot;910&quot; y=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-31&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-22&quot; style=&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;fillColor=#FFE9E9;&quot; value=&quot;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;5. Tenant Resolver - Multi-tenancy isolation and context resolution&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;100&quot; width=&quot;910&quot; x=&quot;10&quot; y=&quot;600&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-32&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-31&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;&quot; value=&quot;&amp;lt;div&amp;gt;- Resolves tenant configuration from Redis cache or PostgreSQL&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Injects tenant_id filter into all database queries&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Enforces data isolation between tenants&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp;- Loads tenant-specific settings (model defaults, feature flags)&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;70&quot; width=&quot;910&quot; y=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-33&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-22&quot; style=&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;fillColor=#FFE9E9;&quot; value=&quot;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;6. Input Guard - Request payload validation and sanitization&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;100&quot; width=&quot;910&quot; x=&quot;10&quot; y=&quot;710&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-34&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-33&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;&quot; value=&quot;&amp;lt;div&amp;gt;- Pydantic schema validation for all request bodies&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Injection prevention (SQL, Cypher, command injection patterns)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Content-type validation and size limits&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp;- Malicious payload detection&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;70&quot; width=&quot;910&quot; y=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-35&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-22&quot; style=&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;fillColor=#FFE9E9;&quot; value=&quot;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;b&amp;gt;7. Output Guard - Response sanitization and compliance&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;100&quot; width=&quot;910&quot; x=&quot;10&quot; y=&quot;820&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-36&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-35&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;&quot; value=&quot;&amp;lt;div&amp;gt;- PII scrubbing (email redaction, phone masking, SSN removal)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Content filtering for sensitive data patterns&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Response size validation and truncation&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp;- Audit logging of all responses with correlation IDs&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;70&quot; width=&quot;910&quot; y=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-37&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-22&quot; style=&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;fillColor=#FFE9E9;&quot; value=&quot;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;8. Error Handler - Centralized exception handling and error response formatting&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;100&quot; width=&quot;910&quot; x=&quot;10&quot; y=&quot;930&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-38&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-37&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;&quot; value=&quot;&amp;lt;div&amp;gt;- PII scrubbing (email redaction, phone masking, SSN removal)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Content filtering for sensitive data patterns&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Response size validation and truncation&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp;- Audit logging of all responses with correlation IDs&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;70&quot; width=&quot;910&quot; y=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-39&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-22&quot; style=&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#FFE9E9;&quot; value=&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;RBAC PERMISSION MATRIX&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;100&quot; width=&quot;910&quot; x=&quot;10&quot; y=&quot;360&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-40&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-39&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;&quot; value=&quot;&amp;lt;div&amp;gt;- admin:&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;agent-runs=CRUD,&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;jobs=CRUD,&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;tools=CRUD,&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;tenants=CRUD,&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;graph(write)=✓&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- operator: &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;agent-runs=CRU,&amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;jobs=CRUD, &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;tools=R,&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;tenants=R,&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;graph(write)=✗&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- user:&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;agent-runs=CR,&amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;jobs=CRD,&amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;tools=R,&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;tenants=✗,&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;graph(write)=✗&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- viewer:&amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;agent-runs=R,&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;jobs=R,&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;tools=R,&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;tenants=✗,&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;graph(write)=✗&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;70&quot; width=&quot;910&quot; y=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-41&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;-zAXcNhFpfNaQYtVMxQg-42&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;&quot; target=&quot;-zAXcNhFpfNaQYtVMxQg-57&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-42&quot; parent=&quot;1&quot; style=&quot;swimlane;whiteSpace=wrap;html=1;fillColor=#EBDED4;&quot; value=&quot;&amp;lt;b style=&amp;quot;text-align: left;&amp;quot;&amp;gt;PHASE 3: Step Execution,&amp;amp;nbsp;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;FOR EACH TODO&amp;lt;/span&amp;gt;&amp;lt;/b&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;855&quot; width=&quot;930&quot; x=&quot;720&quot; y=&quot;1220&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-43&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-42&quot; style=&quot;swimlane;whiteSpace=wrap;html=1;fillColor=#FFF1E6;&quot; value=&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent;&amp;quot;&amp;gt;Step 1) LLM PROVIDERS&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;230&quot; width=&quot;910&quot; x=&quot;10&quot; y=&quot;45&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-44&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-43&quot; style=&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#FFF1E6;&quot; value=&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;OpenAI&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;80&quot; width=&quot;430&quot; x=&quot;10&quot; y=&quot;140&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-45&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-44&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;&quot; value=&quot;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;- Cloud LLM API&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- GPT-4, GPT-3.5, etc.&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;50&quot; width=&quot;430&quot; y=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-46&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-43&quot; style=&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#FFF1E6;&quot; value=&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;Ollama (Local)&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;90&quot; width=&quot;890&quot; x=&quot;10&quot; y=&quot;40&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-47&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-46&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;&quot; value=&quot;&amp;lt;div&amp;gt;&amp;lt;div&amp;gt;- Local LLM hosting&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Self-hosted models:&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;(phi3:mini,&amp;amp;nbsp;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;Mistral,&amp;amp;nbsp;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;LLaMA,&amp;amp;nbsp;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;Qwen,&amp;amp;nbsp;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;Gemma)&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;60&quot; width=&quot;890&quot; y=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-48&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-43&quot; style=&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;fillColor=#FFF1E6;&quot; value=&quot;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;b&amp;gt;Azure OpenAI / Other Providers&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;80&quot; width=&quot;450&quot; x=&quot;450&quot; y=&quot;140&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-49&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-48&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;&quot; value=&quot;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;- Compatible OpenAI-style APIs&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Enterprise deployments&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;50&quot; width=&quot;450&quot; y=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-50&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-42&quot; style=&quot;swimlane;fontStyle=1;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#FFF1E6;&quot; value=&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;Step 2) MCP RUNTIME &amp;amp;amp; TOOLS (34 Tools, 12 Categories)&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;370&quot; width=&quot;910&quot; x=&quot;10&quot; y=&quot;290&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-51&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-50&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;&quot; value=&quot;&amp;lt;div&amp;gt;&amp;lt;div&amp;gt;- Tool Registry (PostgreSQL-backed manifests)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Tool Policies (RBAC per tool, required_scopes)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- MCP Runtime (ToolContext, audit logging)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Tool Invocation:&amp;amp;nbsp;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;Request → Schema Validation → RBAC Check → Execute → Audit Log&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;Tool Categories:&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- GRAPH&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- query, secure_query, generate_cypher, schema, explain&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- SECURITY &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- describe_principal, allowed_operations, validate&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- SYSTEM&amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- health, metrics, config, status&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- CACHE&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- get, set, delete, invalidate&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- CATALOG&amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- discover, describe, search&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- MODEL&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- list, info, warmup, switch&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- AGENT&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- context, history, state&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- ANALYTICS &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- query, aggregate, visualize&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- ADMIN&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- create_index, drop_index, constraint&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- ETL&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;/span&amp;gt;- import, export, transform&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- CRUD&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- create_node, update_node, delete_node&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- EXPORT&amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- csv, json, cypher&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;div&amp;gt;Tool Manifest (from PostgreSQL):&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;{name, description, input_schema, required_scopes,&amp;amp;nbsp;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;rate_limit: {requests: 100, window: 60}}&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;340&quot; width=&quot;910&quot; y=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-52&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-42&quot; style=&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;fillColor=#FFF1E6;&quot; value=&quot;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;Step 3) NL&amp;amp;nbsp;&amp;lt;span style=&amp;quot;text-align: left;&amp;quot;&amp;gt;→&amp;lt;/span&amp;gt;&amp;amp;nbsp;CYPHER PIPELINE&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;160&quot; width=&quot;910&quot; x=&quot;10&quot; y=&quot;675&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-53&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-52&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;&quot; value=&quot;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;text-align: center;&amp;quot;&amp;gt;[In case of GRAPH mode]&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;text-align: center;&amp;quot;&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;div&amp;gt;1. Normalize NL prompt → standardize user question&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;2. Generate Cypher → LLM-based or test hints&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;3. Validate Safety → read-only enforcement, tenant boundaries, injection prevention&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;4. Execute on Memgraph → run validated Cypher query&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;5. Summarize Results → convert graph results to natural language&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;130&quot; width=&quot;910&quot; y=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-54&quot; parent=&quot;1&quot; style=&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#DAE4E6;&quot; value=&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;b&amp;gt;PHASE 4) Agent Run Completion&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;120&quot; width=&quot;930&quot; x=&quot;720&quot; y=&quot;3030&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-55&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-54&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;&quot; value=&quot;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;- State machine: queued → running → succeeded | failed&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Record provenance event for the completed run&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Build API payload: AgentRunResponse {id, status, outputs[], steps[], todos[], metrics}&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Return HTTP response to client&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- UI polling for updates: GET /agent-runs/{id} (ETag support)&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;90&quot; width=&quot;930&quot; y=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-56&quot; edge=&quot;1&quot; parent=&quot;1&quot; source=&quot;-zAXcNhFpfNaQYtVMxQg-57&quot; style=&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;&quot; target=&quot;-zAXcNhFpfNaQYtVMxQg-54&quot;&gt;&#10;          &lt;mxGeometry relative=&quot;1&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-57&quot; parent=&quot;1&quot; style=&quot;swimlane;whiteSpace=wrap;html=1;fillColor=#D7ECE9;&quot; value=&quot;&amp;lt;b style=&amp;quot;text-align: left;&amp;quot;&amp;gt;Step 4 &amp;amp;amp; 5)&amp;lt;/b&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;850&quot; width=&quot;930&quot; x=&quot;720&quot; y=&quot;2130&quot; as=&quot;geometry&quot;&gt;&#10;            &lt;mxRectangle height=&quot;30&quot; width=&quot;100&quot; x=&quot;540&quot; y=&quot;2570&quot; as=&quot;alternateBounds&quot; /&gt;&#10;          &lt;/mxGeometry&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-58&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-57&quot; style=&quot;swimlane;whiteSpace=wrap;html=1;fillColor=#EAFFFB;&quot; value=&quot;ADAPTERS &amp;amp;amp; RESILIENCE FRAMEWORK&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;320&quot; width=&quot;910&quot; x=&quot;10&quot; y=&quot;40&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-59&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-58&quot; style=&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#EAFFFB;&quot; value=&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;b&amp;gt;LLM Adapters&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;110&quot; width=&quot;333.75&quot; x=&quot;16.25&quot; y=&quot;40&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-60&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-59&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;&quot; value=&quot;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;- Ollama adapter (local LLMs)&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;- OpenAI-style API adapter&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Stub/Demo adapter (testing)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Azure OpenAI adapter&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;80&quot; width=&quot;333.75&quot; y=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-61&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-58&quot; style=&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#EAFFFB;&quot; value=&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;b&amp;gt;Resilience Mechanisms&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;110&quot; width=&quot;540&quot; x=&quot;360&quot; y=&quot;40&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-62&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-61&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;&quot; value=&quot;&amp;lt;div&amp;gt;- Circuit Breaker States per provider:&amp;amp;nbsp;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;CLOSED (normal) → OPEN (reject) → HALF_OPEN (test one) → CLOSED&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;- Automatic Retries with exponential backoff&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Cost Tracking per provider/model&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Provider Fallback chain&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;80&quot; width=&quot;540&quot; y=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-63&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-58&quot; style=&quot;swimlane;whiteSpace=wrap;html=1;fillColor=#EAFFFB;&quot; value=&quot;Database Adapters&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;150&quot; width=&quot;883.75&quot; x=&quot;16.25&quot; y=&quot;160&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-64&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-63&quot; style=&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;fillColor=#EAFFFB;&quot; value=&quot;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;Redis Adapter&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;100&quot; width=&quot;80&quot; x=&quot;93.75&quot; y=&quot;40&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-65&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-64&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;&quot; value=&quot;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;- cache&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;- queues&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;- rate limits&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;70&quot; width=&quot;80&quot; y=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-66&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-63&quot; style=&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;fillColor=#EAFFFB;&quot; value=&quot;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;b&amp;gt;PostgreSQL Adapter&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;100&quot; width=&quot;90&quot; x=&quot;403.75&quot; y=&quot;40&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-67&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-66&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;&quot; value=&quot;&amp;lt;div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;- repositories&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;- transactions&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;70&quot; width=&quot;90&quot; y=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-68&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-63&quot; style=&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;fillColor=#EAFFFB;&quot; value=&quot;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;Memgraph Adapter&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;100&quot; width=&quot;100&quot; x=&quot;693.75&quot; y=&quot;40&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-69&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-68&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;&quot; value=&quot;&amp;lt;div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;- graph queries&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;- NL-&amp;amp;gt;Cypher&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;70&quot; width=&quot;100&quot; y=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-70&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-57&quot; style=&quot;swimlane;whiteSpace=wrap;html=1;fillColor=#EADFE9;&quot; value=&quot;DATA &amp;amp;amp; INFRASTRUCTURE LAYER&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;460&quot; width=&quot;910&quot; x=&quot;10&quot; y=&quot;380&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-71&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-70&quot; style=&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#EADFE9;&quot; value=&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;b&amp;gt;PostgreSQL&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;240&quot; width=&quot;280&quot; x=&quot;330&quot; y=&quot;40&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-72&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-71&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;&quot; value=&quot;&amp;lt;div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;Tables:&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- tenants&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Multi-tenant configurations&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- agent_runs&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Agent run records with status&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- steps&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Per-step execution records&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- sessions&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- User session state&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- jobs&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;/span&amp;gt;- Async job records&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- job_events&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Job progress events&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- tool_manifests&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- MCP tool definitions&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- model_defaults&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Default model configurations&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- audit_logs&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- All action audit trail&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;SQLAlchemy + Alembic migrations&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;Used by: App (Background Tasks)&amp;amp;nbsp;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;+ Workers&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;210&quot; width=&quot;280&quot; y=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-73&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-70&quot; style=&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#EADFE9;&quot; value=&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;Memgraph (Graph Database)&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;410&quot; width=&quot;280&quot; x=&quot;620&quot; y=&quot;40&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-74&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-73&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;&quot; value=&quot;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;&amp;lt;b&amp;gt;Nodes:&amp;lt;/b&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- (:User&amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;/span&amp;gt;{id, name, email})&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- (:Task &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;/span&amp;gt;{id, title, status})&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- (:File &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;/span&amp;gt;{id, name, path})&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- (:Institution &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;{id, name})&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- (:Project &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;{id, name})&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;Relationships:&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- (User)-[:ASSIGNED_TO]-&amp;amp;gt;(Task)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- (User)-[:OWNS]-&amp;amp;gt;(File)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- (User)-[:BELONGS_TO]-&amp;amp;gt;(Institution)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- (Task)-[:PART_OF]-&amp;amp;gt;(Project)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- (File)-[:ATTACHED_TO]-&amp;amp;gt;(Task)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;NL-&amp;amp;gt;Cypher Pipeline Components:&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- NL normalization (standardize user question)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Cypher generation (LLM-based or test hints)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Safety validation (read-only, tenant boundaries, injection prevention)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Query execution (run validated Cypher)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Result summarization (convert to natural language)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;Used by: NL-&amp;amp;gt;Cypher, graph.* tools, analytics,&amp;amp;nbsp;ETL jobs&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;380&quot; width=&quot;280&quot; y=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-75&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-70&quot; style=&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#EADFE9;&quot; value=&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;b&amp;gt;Redis (Cache &amp;amp;amp; Queues)&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;330&quot; width=&quot;310&quot; x=&quot;10&quot; y=&quot;40&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-76&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-75&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;&quot; value=&quot;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;&amp;lt;b&amp;gt;CACHE:&amp;lt;/b&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- session:{id}&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;/span&amp;gt;- Session data&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- tenant:config:{id}&amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Tenant configurations&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- model:defaults:{id} &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Model defaults&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;QUEUES:&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- jobs:queue:{type}&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Job queue (LPUSH/BRPOP)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- jobs:events:{id}&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- SSE event buffer (ring)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- jobs:state:{id}&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Job state (HASH)&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;RATE LIMITING:&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- ratelimit:user:{id}&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Per-user limits&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- ratelimit:tenant:{id}&amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Per-tenant limits&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- ratelimit:endpoint:{}&amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Per-endpoint limits&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;CONTROL:&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- idempotency:{key}&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Idempotency mapping&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- circuit:{provider}&amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;/span&amp;gt;- Circuit breaker state&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;Used by: App (Background Tasks) + Workers&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;300&quot; width=&quot;310&quot; y=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-77&quot; parent=&quot;1&quot; style=&quot;swimlane;whiteSpace=wrap;html=1;fillColor=#E0E0E0;&quot; value=&quot;&amp;lt;b style=&amp;quot;text-align: left;&amp;quot;&amp;gt;BACKGROUND FRAMEWORK&amp;lt;/b&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;900&quot; width=&quot;570&quot; x=&quot;70&quot; y=&quot;2130&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-78&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-77&quot; style=&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#F3F3F3;&quot; value=&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;APScheduler&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;110&quot; width=&quot;550&quot; x=&quot;10&quot; y=&quot;40&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-79&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-78&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;&quot; value=&quot;&amp;lt;div&amp;gt;Scheduled Tasks&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Health check (30s): Postgres ping, Redis ping, Memgraph ping, LLM warmup/availability&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Cleanup (hourly): stale/old sessions, expired/stale cache, expired jobs, old job records, orphan runs&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Backup (daily): PostgreSQL dump, Redis RDB snapshot, Memgraph archives, audit logs export&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Provider monitoring: provider health + metrics emission&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;80&quot; width=&quot;550&quot; y=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-80&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-77&quot; style=&quot;swimlane;whiteSpace=wrap;html=1;fillColor=#E0E0E0;&quot; value=&quot;&amp;lt;b style=&amp;quot;text-align: left;&amp;quot;&amp;gt;OBSERVABILITY &amp;amp;amp; MONITORING&amp;lt;/b&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;730&quot; width=&quot;550&quot; x=&quot;10&quot; y=&quot;160&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-81&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-80&quot; style=&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;gradientColor=none;fillColor=#F3F3F3;&quot; value=&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;&amp;lt;b&amp;gt;Prometheus (Metrics Collection)&amp;lt;/b&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;190&quot; width=&quot;530&quot; x=&quot;10&quot; y=&quot;530&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-82&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-81&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;&quot; value=&quot;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;- Scrapes /metrics from: app &amp;amp;amp; workers&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Metrics collected:&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - HTTP request latency &amp;amp;amp; throughput&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - Agent run / step execution metrics&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - Tool invocation metrics&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - LLM token usage &amp;amp;amp; cost&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - LLM provider health / circuit breaker states&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - Job processing metrics&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - Job queue depths&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - System health status&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;160&quot; width=&quot;530&quot; y=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-83&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-80&quot; style=&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;gradientColor=none;fillColor=#F3F3F3;&quot; value=&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;&amp;lt;b&amp;gt;Grafana (Dashboards)&amp;lt;/b&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;140&quot; width=&quot;530&quot; x=&quot;10&quot; y=&quot;380&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-84&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-83&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;&quot; value=&quot;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;- Dashboards for:&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - HTTP request metrics&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - Agent run statistics (runs/steps)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - Job processing &amp;amp;amp; queue metrics&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - Tool invocation stats&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - LLM provider health &amp;amp;amp; circuit breaker states&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - System / component health status&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;110&quot; width=&quot;530&quot; y=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-85&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-80&quot; style=&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;gradientColor=none;fillColor=#F3F3F3;&quot; value=&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;b&amp;gt;Instrumentation &amp;amp;amp; Endpoints&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;150&quot; width=&quot;530&quot; x=&quot;10&quot; y=&quot;40&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-86&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-85&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;&quot; value=&quot;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;- Prometheus /metrics endpoint (exposed by app &amp;amp;amp; workers)&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- OpenTelemetry tracing (OTLP export from app &amp;amp;amp; workers)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Structured logging (JSON format)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Health endpoints:&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - /v1/health/live&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - /v1/health/ready&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - /v1/health/startup&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - /v1/health/components&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;120&quot; width=&quot;530&quot; y=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-87&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-80&quot; style=&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;gradientColor=none;fillColor=#F3F3F3;&quot; value=&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;&amp;lt;b&amp;gt;Tracing (OTel Collector + APM Backend)&amp;lt;/b&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;170&quot; width=&quot;530&quot; x=&quot;10&quot; y=&quot;200&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;        &lt;mxCell id=&quot;-zAXcNhFpfNaQYtVMxQg-88&quot; parent=&quot;-zAXcNhFpfNaQYtVMxQg-87&quot; style=&quot;text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;&quot; value=&quot;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;- OTel Collector / APM:&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - Receives OTLP traces from: app &amp;amp;amp; workers&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - Exports to: Jaeger / Tempo / APM backend&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Trace spans include:&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - Agent run execution (end-to-end)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - Step-by-step processing&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - Tool invocations&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - Database queries&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - Job lifecycle (enqueue → execute → complete/fail/cancel)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&quot; vertex=&quot;1&quot;&gt;&#10;          &lt;mxGeometry height=&quot;140&quot; width=&quot;530&quot; y=&quot;30&quot; as=&quot;geometry&quot; /&gt;&#10;        &lt;/mxCell&gt;&#10;      &lt;/root&gt;&#10;    &lt;/mxGraphModel&gt;&#10;  &lt;/diagram&gt;&#10;&lt;/mxfile&gt;&#10;"><defs/><rect fill="#ffffff" width="100%" height="100%" x="0" y="0" style="fill: light-dark(rgb(255, 255, 255), rgb(18, 18, 18));"/><g><g data-cell-id="0"><g data-cell-id="1"><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-1"><g transform="translate(0.5,0.5)"><path d="M 570 270 L 610 270 L 610 525.2 L 643.63 525.03" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 648.88 525.01 L 641.9 528.54 L 643.63 525.03 L 641.86 521.54 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-2"><g transform="translate(0.5,0.5)"><path d="M 0 40 L 0 0 L 570 0 L 570 40" fill="#e0ddef" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(224, 221, 239), rgb(46, 44, 59)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 0 40 L 0 540 L 570 540 L 570 40" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 0 40 L 570 40" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 568px; height: 1px; padding-top: 20px; margin-left: 1px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; word-wrap: normal; "><div>IDENTITY &amp; AUTHENTICATION LAYER: <span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">CLIENTS &amp; USER INTERFACES</span></div></div></div></div></foreignObject><text x="285" y="24" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle" font-weight="bold">IDENTITY &amp; AUTHENTICATION LAYER: CLIENTS &amp; USER INTERFACES</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-3"><g transform="translate(0.5,0.5)"><path d="M 10 80 L 10 50 L 560 50 L 560 80" fill="#f3f0ff" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(243, 240, 255), rgb(31, 28, 41)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 10 80 L 10 210 L 560 210 L 560 80" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 10 80 L 560 80" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 548px; height: 1px; padding-top: 65px; margin-left: 11px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style=""><b>Identity Provider (OIDC / Auth0)</b></div></div></div></div></foreignObject><text x="285" y="69" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">Identity Provider (OIDC / Auth0)</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-4"><g transform="translate(0.5,0.5)"><rect x="10" y="80" width="550" height="130" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 540px; height: 1px; padding-top: 145px; margin-left: 16px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 126px; overflow: hidden; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div>- OAuth 2.0 login flow</div><div>- JWT tokens (tenant_id, sub, roles[], scopes[], exp, iat)</div><div>- JWKS endpoint for token verification</div><div>- Token refresh &amp; revocation</div><div>- Principal:</div><div><span style="white-space: pre;">	</span>sub, tenant_id, </div><div><span style="white-space: pre;">	</span>roles: [admin, operator, user, viewer], </div><div><span style="white-space: pre;">	</span>scopes: [read, write, graph:read, ...]</div></div></div></div></foreignObject><text x="16" y="149" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">- OAuth 2.0 login flow...</text></switch></g></g></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-5"><g transform="translate(0.5,0.5)"><path d="M 10 250 L 10 220 L 560 220 L 560 250" fill="#f3f0ff" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(243, 240, 255), rgb(31, 28, 41)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 10 250 L 10 430 L 560 430 L 560 250" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 10 250 L 560 250" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 548px; height: 1px; padding-top: 235px; margin-left: 11px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style="text-align: left;"><div><b>Agent Chat UI (Next.js / React)</b></div></div></div></div></div></foreignObject><text x="285" y="239" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">Agent Chat UI (Next.js / React)</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-6"><g transform="translate(0.5,0.5)"><rect x="10" y="250" width="550" height="180" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 540px; height: 1px; padding-top: 340px; margin-left: 16px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 176px; overflow: hidden; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div><div><br class="Apple-interchange-newline" />[AGENT RUN - WORKFLOW A]</div><div><br /></div><div>- End user chat interface</div><div>- JWT-based authentication</div><div>- SSE Streaming support</div><div>- Agent runs &amp; steps display</div><div>- Real-time polling for updates</div></div><div><br /></div><div><div style="font-size: 11px; text-wrap-mode: nowrap;">POST /v1/agent-runs</div><div style="font-size: 11px; text-wrap-mode: nowrap;">- Bearer JWT, prompt, model, temperature</div><div style="font-size: 11px; text-wrap-mode: nowrap;">- Returns: {run_id, status: "queued"}</div></div></div></div></div></foreignObject><text x="16" y="344" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">[AGENT RUN - WORKFLOW A]...</text></switch></g></g></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-7"><g transform="translate(0.5,0.5)"><path d="M 10 470 L 10 440 L 560 440 L 560 470" fill="#f3f0ff" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(243, 240, 255), rgb(31, 28, 41)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 10 470 L 10 530 L 560 530 L 560 470" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 10 470 L 560 470" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 548px; height: 1px; padding-top: 455px; margin-left: 11px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style="text-align: left;"><div><b>Reverse Proxy / API Gateway (NGINX)</b></div></div></div></div></div></foreignObject><text x="285" y="459" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">Reverse Proxy / API Gateway (NGINX)</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-8"><g transform="translate(0.5,0.5)"><rect x="10" y="470" width="550" height="60" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 540px; height: 1px; padding-top: 500px; margin-left: 16px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 56px; overflow: hidden; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">- </span><span style="background-color: transparent;">TLS termination (HTTPS) </span></div><div>- Routing to backend services</div><div>- CORS handling</div><div>- Load balancing </div></div></div></div></foreignObject><text x="16" y="504" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">- TLS termination (HTTPS)...</text></switch></g></g></g></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-9"><g transform="translate(0.5,0.5)"><path d="M 285 860 L 285 933.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 285 938.88 L 281.5 931.88 L 285 933.63 L 288.5 931.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-10"><g transform="translate(0.5,0.5)"><path d="M 0 650 L 0 620 L 570 620 L 570 650" fill="#d7e4d7" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(215, 228, 215), rgb(36, 47, 36)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 0 650 L 0 860 L 570 860 L 570 650" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 0 650 L 570 650" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 568px; height: 1px; padding-top: 635px; margin-left: 1px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style="text-align: left;"><div><b>API LAYER (Routers)</b></div></div></div></div></div></foreignObject><text x="285" y="639" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">API LAYER (Routers)</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-11"><g transform="translate(0.5,0.5)"><rect x="0" y="650" width="570" height="210" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 560px; height: 1px; padding-top: 755px; margin-left: 6px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 206px; overflow: hidden; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div>- /v1/health<span style="white-space: pre;">	</span>- Health probes (live, ready, startup, components)</div><div>- /v1/auth  <span style="white-space: pre;">	</span>- Token introspection, identity verification</div><div>- /v1/agents     - Agent definitions and configurations</div><div>- /v1/agent-runs - Agent run lifecycle (create, poll, cancel)</div><div>- /v1/tools      <span style="white-space: pre;">	</span>- MCP tool registry and invocation</div><div>- /v1/jobs       <span style="white-space: pre;">	</span>- Async job lifecycle (create, stream, cancel)</div><div>- /v1/models   <span style="white-space: pre;">	</span>- Model and provider management</div><div>- /v1/admin     <span style="white-space: pre;">	</span>- Administrative operations</div><div>- /v1/tenants   <span style="white-space: pre;">	</span>- Multi-tenant configuration</div><div>- /v1/sessions <span style="white-space: pre;">	</span>- Session management</div><div>- /v1/graph     <span style="white-space: pre;">	</span>- Graph query endpoints</div><div>- /v1/batch     <span style="white-space: pre;">	</span>- Batch operations</div><div>- /v1/export    <span style="white-space: pre;">	</span>- Data export utilities</div><div>- /v1/internal  <span style="white-space: pre;">	</span>- Internal diagnostics</div></div></div></div></foreignObject><text x="6" y="759" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">- /v1/health	- Health probes (live, ready, startup, components)...</text></switch></g></g></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-12"><g transform="translate(0.5,0.5)"><path d="M 285 1040 L 285 1083.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 285 1088.88 L 281.5 1081.88 L 285 1083.63 L 288.5 1081.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-13"><g transform="translate(0.5,0.5)"><path d="M 0 970 L 0 940 L 570 940 L 570 970" fill="#eaf7ea" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(234, 247, 234), rgb(20, 31, 20)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 0 970 L 0 1040 L 570 1040 L 570 970" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 0 970 L 570 970" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 568px; height: 1px; padding-top: 955px; margin-left: 1px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style="text-align: left;"><div><b>[AGENT RUN ENDPOINTS]</b></div></div></div></div></div></foreignObject><text x="285" y="959" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">[AGENT RUN ENDPOINTS]</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-14"><g transform="translate(0.5,0.5)"><rect x="0" y="970" width="570" height="70" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 560px; height: 1px; padding-top: 1005px; margin-left: 6px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 66px; overflow: hidden; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div>- POST /v1/agent-runs (use_jobs=false → BackgroundTasks)</div><div>- POST /v1/agent-runs?use_jobs=true (→ Jobs Worker)</div><div>- GET /v1/agent-runs/{id} (ETag support for caching)</div><div>- GET /v1/agent-runs/{id}/steps</div></div></div></div></foreignObject><text x="6" y="1009" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">- POST /v1/agent-runs (use_jobs=false → BackgroundTasks)...</text></switch></g></g></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-15"><g transform="translate(0.5,0.5)"><path d="M 570 1440 L 610 1440 L 610 1517.6 L 643.63 1517.52" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 648.88 1517.5 L 641.89 1521.02 L 643.63 1517.52 L 641.87 1514.02 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-16"><g transform="translate(0.5,0.5)"><path d="M 0 1113 L 0 1090 L 570 1090 L 570 1113" fill="#ebdfbc" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(235, 223, 188), rgb(55, 45, 15)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 0 1113 L 0 1790 L 570 1790 L 570 1113" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 0 1113 L 570 1113" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 568px; height: 1px; padding-top: 1102px; margin-left: 1px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; word-wrap: normal; "><div>SERVICE LAYER</div></div></div></div></foreignObject><text x="285" y="1105" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle" font-weight="bold">SERVICE LAYER</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-17"><g transform="translate(0.5,0.5)"><path d="M 10 1160 L 10 1130 L 560 1130 L 560 1160" fill="#fff2cc" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(255, 242, 204), rgb(40, 29, 0)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 10 1160 L 10 1630 L 560 1630 L 560 1160" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 10 1160 L 560 1160" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 548px; height: 1px; padding-top: 1145px; margin-left: 11px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style="text-align: left;"><b>ORCHESTRATOR </b><b>SERVICE</b><b>: 1 Run per prompt, </b><span style="background-color: transparent; text-align: center;"><b>4 Phases</b></span></div></div></div></div></foreignObject><text x="285" y="1149" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">ORCHESTRATOR SERVICE: 1 Run per prompt, 4 Phases</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-18"><g transform="translate(0.5,0.5)"><rect x="10" y="1160" width="550" height="470" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 540px; height: 1px; padding-top: 1395px; margin-left: 16px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 466px; overflow: hidden; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div><b>PHASE 1) INTENT CLASSIFICATION:</b></div><div>- A<span style="background-color: transparent;">nalyzes prompt via LLM<br /></span><span style="background-color: transparent;">- Check params.category → Match prompt catalog → Apply classify_intent()</span><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">:</span></div><div><div>  - CHAT - Conversational responses</div><div>  - GRAPH - Analytics, NL-&gt;Cypher queries</div><div>  - SECURITY - Security/permissions questions</div><div>  - ADMIN - Administrative write operations</div><div>  - DANGEROUS - Destructive ops → refuse + offer EXPLAIN</div><div>  - EXPLAIN - EXPLAIN-only query analysis</div></div><div><br /></div><div><span style="background-color: transparent;"><b>PHASE 2) TODO Planning</b></span><b> (multi-step run):</b></div><div><div style="">- LLM-based planning</div><div style="">- Input: Goal + Context + Schema → Output: TODO Array</div><div style="">- Planning Modes: full (LLM per TODO) | optional (try direct) | none (deterministic)</div></div><div style=""><br /></div><div><div><b>PHASE 3) Step Execution, <span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">FOR EACH TODO</span><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">:</span></b></div><div>  1. Call LLM Provider (planner, reflector, responder)</div><div>  2. Invoke MCP Tools with RBAC check (34 tools available)</div><div>  3. If GRAPH mode: NL-&gt;Cypher pipeline</div><div>  4. Persist step → PostgreSQL <span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">(via adaptor)</span></div><div>  5. Use Redis for session/cache/cancel <span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">(via adaptor)</span></div><div>- Step records: {id, action, input, output, latency_ms, started_at, finished_at}</div></div><div><br /></div><div><div><b>PHASE 4) </b><b style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">Finalization &amp; </b><b style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">Response Generation</b></div><div><div>- build_response() → Orchestration Result</div><div>- Response mode selection: fallback-only | llm-best-effort</div><div>- Canonical output structure: {goal, steps[], outputs[], todos[], metrics}</div><div>- Normalize final output: text + optional JSON payload</div><div>- Safety/compliance: PII scrubbing + output guard checks</div><div>- Persist final state + metrics → PostgreSQL</div><div>- Observability: emit Prometheus metrics + OpenTelemetry traces</div></div></div></div></div></div></foreignObject><text x="16" y="1399" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">PHASE 1) INTENT CLASSIFICATION:...</text></switch></g></g></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-19"><g transform="translate(0.5,0.5)"><path d="M 10 1680 L 10 1650 L 560 1650 L 560 1680" fill="#fff2cc" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(255, 242, 204), rgb(40, 29, 0)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 10 1680 L 10 1770 L 560 1770 L 560 1680" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 10 1680 L 560 1680" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 548px; height: 1px; padding-top: 1665px; margin-left: 11px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style="text-align: left;"><b>ADDITIONAL SERVICES</b></div></div></div></div></foreignObject><text x="285" y="1669" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">ADDITIONAL SERVICES</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-20"><g transform="translate(0.5,0.5)"><rect x="10" y="1680" width="550" height="90" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 540px; height: 1px; padding-top: 1725px; margin-left: 16px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 86px; overflow: hidden; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">- Session Service (state management)</span></div><div>- Job Service (job lifecycle)</div><div>- Default Model Resolver</div><div>- Health / ETL / Archive Services</div><div>- Invocation Store (audit trail)</div></div></div></div></foreignObject><text x="16" y="1729" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">- Session Service (state management)...</text></switch></g></g></g></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-21"><g transform="translate(0.5,0.5)"><path d="M 650 787.5 L 610 787.6 L 610 755.2 L 576.37 755.03" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 571.12 755.01 L 578.14 751.54 L 576.37 755.03 L 578.1 758.54 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-22"><g transform="translate(0.5,0.5)"><path d="M 650 23 L 650 0 L 1580 0 L 1580 23" fill="#ead6d6" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(234, 214, 214), rgb(63, 46, 46)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 650 23 L 650 1050 L 1580 1050 L 1580 23" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 650 23 L 1580 23" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 928px; height: 1px; padding-top: 12px; margin-left: 651px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; word-wrap: normal; "><div style="text-align: left;"><b>SECURITY </b><span style="background-color: transparent; text-align: center;">MIDDLEWARE STACK</span></div></div></div></div></foreignObject><text x="1115" y="15" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle" font-weight="bold">SECURITY MIDDLEWARE STACK</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-23"><g transform="translate(0.5,0.5)"><path d="M 660 70 L 660 40 L 1570 40 L 1570 70" fill="#ffe9e9" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(255, 233, 233), rgb(48, 29, 29)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 660 70 L 660 130 L 1570 130 L 1570 70" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 660 70 L 1570 70" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 908px; height: 1px; padding-top: 55px; margin-left: 661px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style=""><div><b>1. CORS Handler - Cross-Origin Resource Sharing policy enforcement</b></div></div></div></div></div></foreignObject><text x="1115" y="59" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">1. CORS Handler - Cross-Origin Resource Sharing policy enforcement</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-24"><g transform="translate(0.5,0.5)"><rect x="660" y="70" width="910" height="60" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 900px; height: 1px; padding-top: 100px; margin-left: 666px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 56px; overflow: hidden; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div>- Allowed origins, methods, headers configuration</div><div>- Preflight OPTIONS request handling</div><div>- Credentials and expose headers support</div></div></div></div></foreignObject><text x="666" y="104" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">- Allowed origins, methods, headers configuration...</text></switch></g></g></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-25"><g transform="translate(0.5,0.5)"><path d="M 660 170 L 660 140 L 1570 140 L 1570 170" fill="#ffe9e9" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(255, 233, 233), rgb(48, 29, 29)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 660 170 L 660 230 L 1570 230 L 1570 170" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 660 170 L 1570 170" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 908px; height: 1px; padding-top: 155px; margin-left: 661px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style=""><div><b>2. Trace Context - OpenTelemetry distributed tracing context</b></div></div></div></div></div></foreignObject><text x="1115" y="159" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">2. Trace Context - OpenTelemetry distributed tracing context</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-26"><g transform="translate(0.5,0.5)"><rect x="660" y="170" width="910" height="60" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 900px; height: 1px; padding-top: 200px; margin-left: 666px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 56px; overflow: hidden; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div>- Injects/extracts W3C trace-context headers (traceparent, tracestate)</div><div>- Creates root span if missing, propagates existing trace</div><div>- Adds trace_id, span_id, parent_id to request context</div></div></div></div></foreignObject><text x="666" y="204" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">- Injects/extracts W3C trace-context headers (traceparent, tracestate)...</text></switch></g></g></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-27"><g transform="translate(0.5,0.5)"><path d="M 660 270 L 660 240 L 1570 240 L 1570 270" fill="#ffe9e9" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(255, 233, 233), rgb(48, 29, 29)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 660 270 L 660 350 L 1570 350 L 1570 270" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 660 270 L 1570 270" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 908px; height: 1px; padding-top: 255px; margin-left: 661px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style=""><div><b>3. Auth JWT - JWT/OIDC token validation and principal extraction</b></div></div></div></div></div></foreignObject><text x="1115" y="259" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">3. Auth JWT - JWT/OIDC token validation and principal extraction</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-28"><g transform="translate(0.5,0.5)"><rect x="660" y="270" width="910" height="80" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 900px; height: 1px; padding-top: 310px; margin-left: 666px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 76px; overflow: hidden; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div>- Validates Bearer token via JWKS endpoint (RS256/RS384/RS512)</div><div>- Extracts claims: sub, tenant_id, roles[], scopes[], exp, iat</div><div><div>- RBAC &amp; Scope Enforcement for endpoints</div></div><div>- Builds Principal object for downstream authorization</div><div>   - Rejects expired/invalid/malformed tokens with 401 Unauthorized</div></div></div></div></foreignObject><text x="666" y="314" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">- Validates Bearer token via JWKS endpoint (RS256/RS384/RS512)...</text></switch></g></g></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-29"><g transform="translate(0.5,0.5)"><path d="M 660 500 L 660 470 L 1570 470 L 1570 500" fill="#ffe9e9" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(255, 233, 233), rgb(48, 29, 29)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 660 500 L 660 580 L 1570 580 L 1570 500" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 660 500 L 1570 500" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 908px; height: 1px; padding-top: 485px; margin-left: 661px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style=""><div><b>4. Rate Limit - Redis-backed rate limiting with multiple dimensions</b></div></div></div></div></div></foreignObject><text x="1115" y="489" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">4. Rate Limit - Redis-backed rate limiting with multiple dimensions</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-30"><g transform="translate(0.5,0.5)"><rect x="660" y="500" width="910" height="80" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 900px; height: 1px; padding-top: 540px; margin-left: 666px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 76px; overflow: hidden; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div>- Per-user limits: ratelimit:user:{sub}</div><div>- Per-tenant limits: ratelimit:tenant:{tenant_id}</div><div>- Per-endpoint limits: ratelimit:endpoint:{method}:{path}</div><div>   - Sliding window algorithm, returns 429 Too Many Requests when exceeded</div><div>   - X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Reset headers</div></div></div></div></foreignObject><text x="666" y="544" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">- Per-user limits: ratelimit:user:{sub}...</text></switch></g></g></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-31"><g transform="translate(0.5,0.5)"><path d="M 660 630 L 660 600 L 1570 600 L 1570 630" fill="#ffe9e9" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(255, 233, 233), rgb(48, 29, 29)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 660 630 L 660 700 L 1570 700 L 1570 630" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 660 630 L 1570 630" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 908px; height: 1px; padding-top: 615px; margin-left: 661px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style=""><div><b>5. Tenant Resolver - Multi-tenancy isolation and context resolution</b></div></div></div></div></div></foreignObject><text x="1115" y="619" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">5. Tenant Resolver - Multi-tenancy isolation and context resolution</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-32"><g transform="translate(0.5,0.5)"><rect x="660" y="630" width="910" height="70" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 900px; height: 1px; padding-top: 665px; margin-left: 666px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 66px; overflow: hidden; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div>- Resolves tenant configuration from Redis cache or PostgreSQL</div><div>- Injects tenant_id filter into all database queries</div><div>- Enforces data isolation between tenants</div><div>   - Loads tenant-specific settings (model defaults, feature flags)</div></div></div></div></foreignObject><text x="666" y="669" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">- Resolves tenant configuration from Redis cache or PostgreSQL...</text></switch></g></g></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-33"><g transform="translate(0.5,0.5)"><path d="M 660 740 L 660 710 L 1570 710 L 1570 740" fill="#ffe9e9" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(255, 233, 233), rgb(48, 29, 29)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 660 740 L 660 810 L 1570 810 L 1570 740" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 660 740 L 1570 740" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 908px; height: 1px; padding-top: 725px; margin-left: 661px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style=""><div><b>6. Input Guard - Request payload validation and sanitization</b></div></div></div></div></div></foreignObject><text x="1115" y="729" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">6. Input Guard - Request payload validation and sanitization</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-34"><g transform="translate(0.5,0.5)"><rect x="660" y="740" width="910" height="70" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 900px; height: 1px; padding-top: 775px; margin-left: 666px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 66px; overflow: hidden; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div>- Pydantic schema validation for all request bodies</div><div>- Injection prevention (SQL, Cypher, command injection patterns)</div><div>- Content-type validation and size limits</div><div>   - Malicious payload detection</div></div></div></div></foreignObject><text x="666" y="779" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">- Pydantic schema validation for all request bodies...</text></switch></g></g></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-35"><g transform="translate(0.5,0.5)"><path d="M 660 850 L 660 820 L 1570 820 L 1570 850" fill="#ffe9e9" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(255, 233, 233), rgb(48, 29, 29)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 660 850 L 660 920 L 1570 920 L 1570 850" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 660 850 L 1570 850" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 908px; height: 1px; padding-top: 835px; margin-left: 661px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style=""><b>7. Output Guard - Response sanitization and compliance</b></div></div></div></div></foreignObject><text x="1115" y="839" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">7. Output Guard - Response sanitization and compliance</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-36"><g transform="translate(0.5,0.5)"><rect x="660" y="850" width="910" height="70" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 900px; height: 1px; padding-top: 885px; margin-left: 666px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 66px; overflow: hidden; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div>- PII scrubbing (email redaction, phone masking, SSN removal)</div><div>- Content filtering for sensitive data patterns</div><div>- Response size validation and truncation</div><div>   - Audit logging of all responses with correlation IDs</div></div></div></div></foreignObject><text x="666" y="889" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">- PII scrubbing (email redaction, phone masking, SSN removal)...</text></switch></g></g></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-37"><g transform="translate(0.5,0.5)"><path d="M 660 960 L 660 930 L 1570 930 L 1570 960" fill="#ffe9e9" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(255, 233, 233), rgb(48, 29, 29)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 660 960 L 660 1030 L 1570 1030 L 1570 960" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 660 960 L 1570 960" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 908px; height: 1px; padding-top: 945px; margin-left: 661px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style=""><div><b>8. Error Handler - Centralized exception handling and error response formatting</b></div></div></div></div></div></foreignObject><text x="1115" y="949" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">8. Error Handler - Centralized exception handling and error response formatting</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-38"><g transform="translate(0.5,0.5)"><rect x="660" y="960" width="910" height="70" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 900px; height: 1px; padding-top: 995px; margin-left: 666px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 66px; overflow: hidden; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div>- PII scrubbing (email redaction, phone masking, SSN removal)</div><div>- Content filtering for sensitive data patterns</div><div>- Response size validation and truncation</div><div>   - Audit logging of all responses with correlation IDs</div></div></div></div></foreignObject><text x="666" y="999" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">- PII scrubbing (email redaction, phone masking, SSN removal)...</text></switch></g></g></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-39"><g transform="translate(0.5,0.5)"><path d="M 660 390 L 660 360 L 1570 360 L 1570 390" fill="#ffe9e9" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(255, 233, 233), rgb(48, 29, 29)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 660 390 L 660 460 L 1570 460 L 1570 390" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 660 390 L 1570 390" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 908px; height: 1px; padding-top: 375px; margin-left: 661px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style="text-align: left;"><div><b>RBAC PERMISSION MATRIX</b></div></div></div></div></div></foreignObject><text x="1115" y="379" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">RBAC PERMISSION MATRIX</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-40"><g transform="translate(0.5,0.5)"><rect x="660" y="390" width="910" height="70" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 900px; height: 1px; padding-top: 425px; margin-left: 666px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 66px; overflow: hidden; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div>- admin:    <span style="white-space: pre;">	</span>agent-runs=CRUD,<span style="white-space: pre;">	</span>jobs=CRUD,<span style="white-space: pre;">	</span>tools=CRUD,<span style="white-space: pre;">	</span>tenants=CRUD,<span style="white-space: pre;">	</span>graph(write)=✓</div><div>- operator: <span style="white-space: pre;">	</span>agent-runs=CRU,  <span style="white-space: pre;">	</span>jobs=CRUD, <span style="white-space: pre;">	</span>tools=R,    <span style="white-space: pre;">	</span>tenants=R,    <span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>graph(write)=✗</div><div>- user:     <span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>agent-runs=CR,   <span style="white-space: pre;">	</span>jobs=CRD,  <span style="white-space: pre;">	</span>tools=R,    <span style="white-space: pre;">	</span>tenants=✗,    <span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>graph(write)=✗</div><div>- viewer:   <span style="white-space: pre;">	</span>agent-runs=R,    <span style="white-space: pre;">	</span>jobs=R,    <span style="white-space: pre;">	</span>tools=R,    <span style="white-space: pre;">	</span>tenants=✗,    <span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>graph(write)=✗</div></div></div></div></foreignObject><text x="666" y="429" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">- admin:    	agent-runs=CRUD,	jobs=CRUD,	tools=CRUD,	tenants=CRUD,	graph(write)=✓...</text></switch></g></g></g></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-41"><g transform="translate(0.5,0.5)"><path d="M 1115 1945 L 1115 1993.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 1115 1998.88 L 1111.5 1991.88 L 1115 1993.63 L 1118.5 1991.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-42"><g transform="translate(0.5,0.5)"><path d="M 650 1113 L 650 1090 L 1580 1090 L 1580 1113" fill="#ebded4" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(235, 222, 212), rgb(54, 43, 34)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 650 1113 L 650 1945 L 1580 1945 L 1580 1113" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 650 1113 L 1580 1113" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 928px; height: 1px; padding-top: 1102px; margin-left: 651px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; word-wrap: normal; "><b style="text-align: left;">PHASE 3: Step Execution, <span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">FOR EACH TODO</span></b></div></div></div></foreignObject><text x="1115" y="1105" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle" font-weight="bold">PHASE 3: Step Execution, FOR EACH TODO</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-43"><g transform="translate(0.5,0.5)"><path d="M 660 1158 L 660 1135 L 1570 1135 L 1570 1158" fill="#fff1e6" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(255, 241, 230), rgb(38, 26, 17)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 660 1158 L 660 1365 L 1570 1365 L 1570 1158" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 660 1158 L 1570 1158" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 908px; height: 1px; padding-top: 1147px; margin-left: 661px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; word-wrap: normal; "><div style="text-align: left;"><span style="background-color: transparent;">Step 1) LLM PROVIDERS</span></div></div></div></div></foreignObject><text x="1115" y="1150" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle" font-weight="bold">Step 1) LLM PROVIDERS</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-44"><g transform="translate(0.5,0.5)"><path d="M 670 1305 L 670 1275 L 1100 1275 L 1100 1305" fill="#fff1e6" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(255, 241, 230), rgb(38, 26, 17)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 670 1305 L 670 1355 L 1100 1355 L 1100 1305" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 670 1305 L 1100 1305" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 428px; height: 1px; padding-top: 1290px; margin-left: 671px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style="text-align: left;"><div><b>OpenAI</b></div></div></div></div></div></foreignObject><text x="885" y="1294" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">OpenAI</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-45"><g transform="translate(0.5,0.5)"><rect x="670" y="1305" width="430" height="50" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 420px; height: 1px; padding-top: 1330px; margin-left: 676px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 46px; overflow: hidden; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">- Cloud LLM API</span></div><div>- GPT-4, GPT-3.5, etc.</div></div></div></div></foreignObject><text x="676" y="1334" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">- Cloud LLM API...</text></switch></g></g></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-46"><g transform="translate(0.5,0.5)"><path d="M 670 1205 L 670 1175 L 1560 1175 L 1560 1205" fill="#fff1e6" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(255, 241, 230), rgb(38, 26, 17)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 670 1205 L 670 1265 L 1560 1265 L 1560 1205" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 670 1205 L 1560 1205" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 888px; height: 1px; padding-top: 1190px; margin-left: 671px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style="text-align: left;"><div><b>Ollama (Local)</b></div></div></div></div></div></foreignObject><text x="1115" y="1194" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">Ollama (Local)</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-47"><g transform="translate(0.5,0.5)"><rect x="670" y="1205" width="890" height="60" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 880px; height: 1px; padding-top: 1235px; margin-left: 676px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 56px; overflow: hidden; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div><div>- Local LLM hosting</div><div>- Self-hosted models:</div><div><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">(phi3:mini, </span><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">Mistral, </span><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">LLaMA, </span><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">Qwen, </span><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">Gemma)</span></div></div></div></div></div></foreignObject><text x="676" y="1239" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">- Local LLM hosting...</text></switch></g></g></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-48"><g transform="translate(0.5,0.5)"><path d="M 1110 1305 L 1110 1275 L 1560 1275 L 1560 1305" fill="#fff1e6" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(255, 241, 230), rgb(38, 26, 17)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 1110 1305 L 1110 1355 L 1560 1355 L 1560 1305" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 1110 1305 L 1560 1305" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 448px; height: 1px; padding-top: 1290px; margin-left: 1111px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style=""><b>Azure OpenAI / Other Providers</b></div></div></div></div></foreignObject><text x="1335" y="1294" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">Azure OpenAI / Other Providers</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-49"><g transform="translate(0.5,0.5)"><rect x="1110" y="1305" width="450" height="50" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 440px; height: 1px; padding-top: 1330px; margin-left: 1116px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 46px; overflow: hidden; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">- Compatible OpenAI-style APIs</span></div><div>- Enterprise deployments</div></div></div></div></foreignObject><text x="1116" y="1334" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">- Compatible OpenAI-style APIs...</text></switch></g></g></g></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-50"><g transform="translate(0.5,0.5)"><path d="M 660 1410 L 660 1380 L 1570 1380 L 1570 1410" fill="#fff1e6" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(255, 241, 230), rgb(38, 26, 17)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 660 1410 L 660 1750 L 1570 1750 L 1570 1410" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 660 1410 L 1570 1410" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 908px; height: 1px; padding-top: 1395px; margin-left: 661px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; word-wrap: normal; "><div style="text-align: left;"><div>Step 2) MCP RUNTIME &amp; TOOLS (34 Tools, 12 Categories)</div></div></div></div></div></foreignObject><text x="1115" y="1399" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle" font-weight="bold">Step 2) MCP RUNTIME &amp; TOOLS (34 Tools, 12 Categories)</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-51"><g transform="translate(0.5,0.5)"><rect x="660" y="1410" width="910" height="340" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 900px; height: 1px; padding-top: 1580px; margin-left: 666px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 336px; overflow: hidden; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div><div>- Tool Registry (PostgreSQL-backed manifests)</div><div>- Tool Policies (RBAC per tool, required_scopes)</div><div>- MCP Runtime (ToolContext, audit logging)</div><div>- Tool Invocation: </div><div><span style="white-space: pre;">	</span>Request → Schema Validation → RBAC Check → Execute → Audit Log</div></div><div><br /></div><div><div><b>Tool Categories:</b></div><div>- GRAPH    <span style="white-space: pre;">	</span>- query, secure_query, generate_cypher, schema, explain</div><div>- SECURITY <span style="white-space: pre;">	</span>- describe_principal, allowed_operations, validate</div><div>- SYSTEM   <span style="white-space: pre;">	</span>- health, metrics, config, status</div><div>- CACHE    <span style="white-space: pre;">	</span>- get, set, delete, invalidate</div><div>- CATALOG  <span style="white-space: pre;">	</span>- discover, describe, search</div><div>- MODEL    <span style="white-space: pre;">	</span>- list, info, warmup, switch</div><div>- AGENT    <span style="white-space: pre;">	</span>- context, history, state</div><div>- ANALYTICS <span style="white-space: pre;">	</span>- query, aggregate, visualize</div><div>- ADMIN    <span style="white-space: pre;">	</span>- create_index, drop_index, constraint</div><div>- ETL      <span style="white-space: pre;">	<span style="white-space: pre;">	</span></span>- import, export, transform</div><div>- CRUD     <span style="white-space: pre;">	</span>- create_node, update_node, delete_node</div><div>- EXPORT   <span style="white-space: pre;">	</span>- csv, json, cypher</div></div><div><br /></div><div><div>Tool Manifest (from PostgreSQL):</div><div>{name, description, input_schema, required_scopes, </div><div>rate_limit: {requests: 100, window: 60}}</div></div><div><br /></div></div></div></div></foreignObject><text x="666" y="1584" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">- Tool Registry (PostgreSQL-backed manifests)...</text></switch></g></g></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-52"><g transform="translate(0.5,0.5)"><path d="M 660 1795 L 660 1765 L 1570 1765 L 1570 1795" fill="#fff1e6" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(255, 241, 230), rgb(38, 26, 17)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 660 1795 L 660 1925 L 1570 1925 L 1570 1795" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 660 1795 L 1570 1795" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 908px; height: 1px; padding-top: 1780px; margin-left: 661px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style=""><div><b>Step 3) NL <span style="text-align: left;">→</span> CYPHER PIPELINE</b></div></div></div></div></div></foreignObject><text x="1115" y="1784" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">Step 3) NL → CYPHER PIPELINE</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-53"><g transform="translate(0.5,0.5)"><rect x="660" y="1795" width="910" height="130" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 900px; height: 1px; padding-top: 1860px; margin-left: 666px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 126px; overflow: hidden; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div><span style="text-align: center;">[In case of GRAPH mode]</span><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"></span></div><div><span style="text-align: center;"><br /></span></div><div><div>1. Normalize NL prompt → standardize user question</div><div>2. Generate Cypher → LLM-based or test hints</div><div>3. Validate Safety → read-only enforcement, tenant boundaries, injection prevention</div><div>4. Execute on Memgraph → run validated Cypher query</div><div>5. Summarize Results → convert graph results to natural language</div></div></div></div></div></foreignObject><text x="666" y="1864" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">[In case of GRAPH mode]...</text></switch></g></g></g></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-54"><g transform="translate(0.5,0.5)"><path d="M 650 2930 L 650 2900 L 1580 2900 L 1580 2930" fill="#dae4e6" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(218, 228, 230), rgb(36, 45, 47)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 650 2930 L 650 3020 L 1580 3020 L 1580 2930" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 650 2930 L 1580 2930" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 928px; height: 1px; padding-top: 2915px; margin-left: 651px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style="text-align: left;"><b>PHASE 4) Agent Run Completion</b></div></div></div></div></foreignObject><text x="1115" y="2919" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">PHASE 4) Agent Run Completion</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-55"><g transform="translate(0.5,0.5)"><rect x="650" y="2930" width="930" height="90" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 920px; height: 1px; padding-top: 2975px; margin-left: 656px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 86px; overflow: hidden; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">- State machine: queued → running → succeeded | failed</span></div><div>- Record provenance event for the completed run</div><div>- Build API payload: AgentRunResponse {id, status, outputs[], steps[], todos[], metrics}</div><div>- Return HTTP response to client</div><div>- UI polling for updates: GET /agent-runs/{id} (ETag support)</div></div></div></div></foreignObject><text x="656" y="2979" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">- State machine: queued → running → succeeded | failed...</text></switch></g></g></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-56"><g transform="translate(0.5,0.5)"><path d="M 1115 2850 L 1115 2893.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 1115 2898.88 L 1111.5 2891.88 L 1115 2893.63 L 1118.5 2891.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(0, 0, 0), rgb(255, 255, 255)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-57"><g transform="translate(0.5,0.5)"><path d="M 650 2023 L 650 2000 L 1580 2000 L 1580 2023" fill="#d7ece9" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(215, 236, 233), rgb(24, 42, 39)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 650 2023 L 650 2850 L 1580 2850 L 1580 2023" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 650 2023 L 1580 2023" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 928px; height: 1px; padding-top: 2012px; margin-left: 651px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; word-wrap: normal; "><b style="text-align: left;">Step 4 &amp; 5)</b></div></div></div></foreignObject><text x="1115" y="2015" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle" font-weight="bold">Step 4 &amp; 5)</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-58"><g transform="translate(0.5,0.5)"><path d="M 660 2063 L 660 2040 L 1570 2040 L 1570 2063" fill="#eafffb" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(234, 255, 251), rgb(8, 26, 23)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 660 2063 L 660 2360 L 1570 2360 L 1570 2063" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 660 2063 L 1570 2063" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 908px; height: 1px; padding-top: 2052px; margin-left: 661px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; word-wrap: normal; ">ADAPTERS &amp; RESILIENCE FRAMEWORK</div></div></div></foreignObject><text x="1115" y="2055" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle" font-weight="bold">ADAPTERS &amp; RESILIENCE FRAMEWORK</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-59"><g transform="translate(0.5,0.5)"><path d="M 676.25 2110 L 676.25 2080 L 1010 2080 L 1010 2110" fill="#eafffb" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(234, 255, 251), rgb(8, 26, 23)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 676.25 2110 L 676.25 2190 L 1010 2190 L 1010 2110" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 676.25 2110 L 1010 2110" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 332px; height: 1px; padding-top: 2095px; margin-left: 677px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style="text-align: left;"><b>LLM Adapters</b></div></div></div></div></foreignObject><text x="843" y="2099" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">LLM Adapters</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-60"><g transform="translate(0.5,0.5)"><rect x="676.25" y="2110" width="333.75" height="80" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 324px; height: 1px; padding-top: 2150px; margin-left: 682px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 76px; overflow: hidden; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">- Ollama adapter (local LLMs)</span></div><div><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">- OpenAI-style API adapter</span></div><div>- Stub/Demo adapter (testing)</div><div>- Azure OpenAI adapter</div></div></div></div></foreignObject><text x="682" y="2154" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">- Ollama adapter (local LLMs)...</text></switch></g></g></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-61"><g transform="translate(0.5,0.5)"><path d="M 1020 2110 L 1020 2080 L 1560 2080 L 1560 2110" fill="#eafffb" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(234, 255, 251), rgb(8, 26, 23)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 1020 2110 L 1020 2190 L 1560 2190 L 1560 2110" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 1020 2110 L 1560 2110" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 538px; height: 1px; padding-top: 2095px; margin-left: 1021px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style="text-align: left;"><b>Resilience Mechanisms</b></div></div></div></div></foreignObject><text x="1290" y="2099" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">Resilience Mechanisms</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-62"><g transform="translate(0.5,0.5)"><rect x="1020" y="2110" width="540" height="80" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 530px; height: 1px; padding-top: 2150px; margin-left: 1026px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 76px; overflow: hidden; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div>- Circuit Breaker States per provider: </div><div><span style="white-space: pre;">	</span>CLOSED (normal) → OPEN (reject) → HALF_OPEN (test one) → CLOSED</div><div><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">- Automatic Retries with exponential backoff</span></div><div>- Cost Tracking per provider/model</div><div>- Provider Fallback chain</div></div></div></div></foreignObject><text x="1026" y="2154" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">- Circuit Breaker States per provider:...</text></switch></g></g></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-63"><g transform="translate(0.5,0.5)"><path d="M 676.25 2223 L 676.25 2200 L 1560 2200 L 1560 2223" fill="#eafffb" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(234, 255, 251), rgb(8, 26, 23)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 676.25 2223 L 676.25 2350 L 1560 2350 L 1560 2223" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 676.25 2223 L 1560 2223" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 882px; height: 1px; padding-top: 2212px; margin-left: 677px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; word-wrap: normal; ">Database Adapters</div></div></div></foreignObject><text x="1118" y="2215" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle" font-weight="bold">Database Adapters</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-64"><g transform="translate(0.5,0.5)"><path d="M 770 2270 L 770 2240 L 850 2240 L 850 2270" fill="#eafffb" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(234, 255, 251), rgb(8, 26, 23)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 770 2270 L 770 2340 L 850 2340 L 850 2270" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 770 2270 L 850 2270" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 2255px; margin-left: 771px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style=""><div><b>Redis Adapter</b></div></div></div></div></div></foreignObject><text x="810" y="2259" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">Redis Adapter</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-65"><g transform="translate(0.5,0.5)"><rect x="770" y="2270" width="80" height="70" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 70px; height: 1px; padding-top: 2305px; margin-left: 776px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 66px; overflow: hidden; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">- cache</span></div><div><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">- queues</span></div><div><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">- rate limits</span></div></div></div></div></foreignObject><text x="776" y="2309" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">- cache...</text></switch></g></g></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-66"><g transform="translate(0.5,0.5)"><path d="M 1080 2270 L 1080 2240 L 1170 2240 L 1170 2270" fill="#eafffb" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(234, 255, 251), rgb(8, 26, 23)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 1080 2270 L 1080 2340 L 1170 2340 L 1170 2270" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 1080 2270 L 1170 2270" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 88px; height: 1px; padding-top: 2255px; margin-left: 1081px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style=""><b>PostgreSQL Adapter</b></div></div></div></div></foreignObject><text x="1125" y="2259" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">PostgreSQL Adap...</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-67"><g transform="translate(0.5,0.5)"><rect x="1080" y="2270" width="90" height="70" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 80px; height: 1px; padding-top: 2305px; margin-left: 1086px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 66px; overflow: hidden; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div></div><div><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">- repositories</span></div><div><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">- transactions</span></div></div></div></div></foreignObject><text x="1086" y="2309" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">- repositorie...</text></switch></g></g></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-68"><g transform="translate(0.5,0.5)"><path d="M 1370 2270 L 1370 2240 L 1470 2240 L 1470 2270" fill="#eafffb" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(234, 255, 251), rgb(8, 26, 23)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 1370 2270 L 1370 2340 L 1470 2340 L 1470 2270" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 1370 2270 L 1470 2270" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 98px; height: 1px; padding-top: 2255px; margin-left: 1371px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style=""><div><b>Memgraph Adapter</b></div></div></div></div></div></foreignObject><text x="1420" y="2259" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">Memgraph Adapter</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-69"><g transform="translate(0.5,0.5)"><rect x="1370" y="2270" width="100" height="70" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 90px; height: 1px; padding-top: 2305px; margin-left: 1376px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 66px; overflow: hidden; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div></div><div><div><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">- graph queries</span></div><div><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">- NL-&gt;Cypher</span></div></div></div></div></div></foreignObject><text x="1376" y="2309" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">- graph queries...</text></switch></g></g></g></g></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-70"><g transform="translate(0.5,0.5)"><path d="M 660 2403 L 660 2380 L 1570 2380 L 1570 2403" fill="#eadfe9" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(234, 223, 233), rgb(49, 40, 48)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 660 2403 L 660 2840 L 1570 2840 L 1570 2403" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 660 2403 L 1570 2403" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 908px; height: 1px; padding-top: 2392px; margin-left: 661px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; word-wrap: normal; ">DATA &amp; INFRASTRUCTURE LAYER</div></div></div></foreignObject><text x="1115" y="2395" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle" font-weight="bold">DATA &amp; INFRASTRUCTURE LAYER</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-71"><g transform="translate(0.5,0.5)"><path d="M 990 2450 L 990 2420 L 1270 2420 L 1270 2450" fill="#eadfe9" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(234, 223, 233), rgb(49, 40, 48)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 990 2450 L 990 2660 L 1270 2660 L 1270 2450" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 990 2450 L 1270 2450" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 278px; height: 1px; padding-top: 2435px; margin-left: 991px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style="text-align: left;"><b>PostgreSQL</b></div></div></div></div></foreignObject><text x="1130" y="2439" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">PostgreSQL</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-72"><g transform="translate(0.5,0.5)"><rect x="990" y="2450" width="280" height="210" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 270px; height: 1px; padding-top: 2555px; margin-left: 996px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 206px; overflow: hidden; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div><div><b>Tables:</b></div><div>- tenants       <span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>- Multi-tenant configurations</div><div>- agent_runs        <span style="white-space: pre;">	</span>- Agent run records with status</div><div>- steps             <span style="white-space: pre;">	</span>- Per-step execution records</div><div>- sessions          <span style="white-space: pre;">	</span>- User session state</div><div>- jobs              <span style="white-space: pre;">	<span style="white-space: pre;">	</span></span>- Async job records</div><div>- job_events        <span style="white-space: pre;">	</span>- Job progress events</div><div>- tool_manifests    <span style="white-space: pre;">	</span>- MCP tool definitions</div><div>- model_defaults    <span style="white-space: pre;">	</span>- Default model configurations</div><div>- audit_logs        <span style="white-space: pre;">	</span>- All action audit trail</div></div><div><div><br /></div><div>SQLAlchemy + Alembic migrations</div><div>Used by: App (Background Tasks) <span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">+ Workers</span></div></div></div></div></div></foreignObject><text x="996" y="2559" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">Tables:...</text></switch></g></g></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-73"><g transform="translate(0.5,0.5)"><path d="M 1280 2450 L 1280 2420 L 1560 2420 L 1560 2450" fill="#eadfe9" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(234, 223, 233), rgb(49, 40, 48)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 1280 2450 L 1280 2830 L 1560 2830 L 1560 2450" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 1280 2450 L 1560 2450" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 278px; height: 1px; padding-top: 2435px; margin-left: 1281px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style="text-align: left;"><div><b>Memgraph (Graph Database)</b></div></div></div></div></div></foreignObject><text x="1420" y="2439" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">Memgraph (Graph Database)</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-74"><g transform="translate(0.5,0.5)"><rect x="1280" y="2450" width="280" height="380" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 270px; height: 1px; padding-top: 2640px; margin-left: 1286px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 376px; overflow: hidden; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"><b>Nodes:</b></span></div><div>- (:User <span style="white-space: pre;">	<span style="white-space: pre;">	</span></span>{id, name, email})</div><div>- (:Task <span style="white-space: pre;">	<span style="white-space: pre;">	</span></span>{id, title, status})</div><div>- (:File <span style="white-space: pre;">	<span style="white-space: pre;">	</span></span>{id, name, path})</div><div>- (:Institution <span style="white-space: pre;">	</span>{id, name})</div><div>- (:Project <span style="white-space: pre;">	</span>{id, name})</div><div><br /></div><div><b>Relationships:</b></div><div>- (User)-[:ASSIGNED_TO]-&gt;(Task)</div><div>- (User)-[:OWNS]-&gt;(File)</div><div>- (User)-[:BELONGS_TO]-&gt;(Institution)</div><div>- (Task)-[:PART_OF]-&gt;(Project)</div><div>- (File)-[:ATTACHED_TO]-&gt;(Task)</div><div><br /></div><div><b>NL-&gt;Cypher Pipeline Components:</b></div><div>- NL normalization (standardize user question)</div><div>- Cypher generation (LLM-based or test hints)</div><div>- Safety validation (read-only, tenant boundaries, injection prevention)</div><div>- Query execution (run validated Cypher)</div><div>- Result summarization (convert to natural language)</div><div><br /></div><div>Used by: NL-&gt;Cypher, graph.* tools, analytics, ETL jobs</div></div></div></div></foreignObject><text x="1286" y="2644" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">Nodes:...</text></switch></g></g></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-75"><g transform="translate(0.5,0.5)"><path d="M 670 2450 L 670 2420 L 980 2420 L 980 2450" fill="#eadfe9" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(234, 223, 233), rgb(49, 40, 48)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 670 2450 L 670 2750 L 980 2750 L 980 2450" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 670 2450 L 980 2450" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 308px; height: 1px; padding-top: 2435px; margin-left: 671px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style="text-align: left;"><b>Redis (Cache &amp; Queues)</b></div></div></div></div></foreignObject><text x="825" y="2439" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">Redis (Cache &amp; Queues)</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-76"><g transform="translate(0.5,0.5)"><rect x="670" y="2450" width="310" height="300" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 300px; height: 1px; padding-top: 2600px; margin-left: 676px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 296px; overflow: hidden; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"><b>CACHE:</b></span></div><div>- session:{id}         <span style="white-space: pre;">	<span style="white-space: pre;">	</span></span>- Session data</div><div>- tenant:config:{id}   <span style="white-space: pre;">	</span>- Tenant configurations</div><div>- model:defaults:{id} <span style="white-space: pre;">	</span>- Model defaults</div><div><br /></div><div><div><b>QUEUES:</b></div><div>- jobs:queue:{type}    <span style="white-space: pre;">	</span>- Job queue (LPUSH/BRPOP)</div><div>- jobs:events:{id}     <span style="white-space: pre;">	</span>- SSE event buffer (ring)</div><div>- jobs:state:{id}      <span style="white-space: pre;">	</span><span style="white-space: pre;">	</span>- Job state (HASH)</div></div><div><br /></div><div><b>RATE LIMITING:</b></div><div>- ratelimit:user:{id}     <span style="white-space: pre;">	</span>- Per-user limits</div><div>- ratelimit:tenant:{id}   <span style="white-space: pre;">	</span>- Per-tenant limits</div><div>- ratelimit:endpoint:{}   <span style="white-space: pre;">	</span>- Per-endpoint limits</div><div><br /></div><div><b>CONTROL:</b></div><div>- idempotency:{key}    <span style="white-space: pre;">	</span>- Idempotency mapping</div><div>- circuit:{provider}   <span style="white-space: pre;">	<span style="white-space: pre;">	</span></span>- Circuit breaker state</div><div><br /></div><div>Used by: App (Background Tasks) + Workers</div></div></div></div></foreignObject><text x="676" y="2604" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">CACHE:...</text></switch></g></g></g></g></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-77"><g transform="translate(0.5,0.5)"><path d="M 0 2023 L 0 2000 L 570 2000 L 570 2023" fill="#e0e0e0" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(224, 224, 224), rgb(45, 45, 45)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 0 2023 L 0 2900 L 570 2900 L 570 2023" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 0 2023 L 570 2023" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 568px; height: 1px; padding-top: 2012px; margin-left: 1px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; word-wrap: normal; "><b style="text-align: left;">BACKGROUND FRAMEWORK</b></div></div></div></foreignObject><text x="285" y="2015" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle" font-weight="bold">BACKGROUND FRAMEWORK</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-78"><g transform="translate(0.5,0.5)"><path d="M 10 2070 L 10 2040 L 560 2040 L 560 2070" fill="#f3f3f3" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(243, 243, 243), rgb(28, 28, 28)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 10 2070 L 10 2150 L 560 2150 L 560 2070" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 10 2070 L 560 2070" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 548px; height: 1px; padding-top: 2055px; margin-left: 11px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style="text-align: left;"><div><b>APScheduler</b></div></div></div></div></div></foreignObject><text x="285" y="2059" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">APScheduler</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-79"><g transform="translate(0.5,0.5)"><rect x="10" y="2070" width="550" height="80" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 540px; height: 1px; padding-top: 2110px; margin-left: 16px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 76px; overflow: hidden; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div>Scheduled Tasks</div><div>- Health check (30s): Postgres ping, Redis ping, Memgraph ping, LLM warmup/availability</div><div>- Cleanup (hourly): stale/old sessions, expired/stale cache, expired jobs, old job records, orphan runs</div><div>- Backup (daily): PostgreSQL dump, Redis RDB snapshot, Memgraph archives, audit logs export</div><div>- Provider monitoring: provider health + metrics emission</div><div><br /></div></div></div></div></foreignObject><text x="16" y="2114" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">Scheduled Tasks...</text></switch></g></g></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-80"><g transform="translate(0.5,0.5)"><path d="M 10 2183 L 10 2160 L 560 2160 L 560 2183" fill="#e0e0e0" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(224, 224, 224), rgb(45, 45, 45)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 10 2183 L 10 2890 L 560 2890 L 560 2183" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 10 2183 L 560 2183" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 548px; height: 1px; padding-top: 2172px; margin-left: 11px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; font-weight: bold; white-space: normal; word-wrap: normal; "><b style="text-align: left;">OBSERVABILITY &amp; MONITORING</b></div></div></div></foreignObject><text x="285" y="2175" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle" font-weight="bold">OBSERVABILITY &amp; MONITORING</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-81"><g transform="translate(0.5,0.5)"><path d="M 20 2720 L 20 2690 L 550 2690 L 550 2720" fill="#f3f3f3" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(243, 243, 243), rgb(28, 28, 28)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 20 2720 L 20 2880 L 550 2880 L 550 2720" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 20 2720 L 550 2720" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 528px; height: 1px; padding-top: 2705px; margin-left: 21px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style="text-align: left;"><div><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"><b>Prometheus (Metrics Collection)</b></span></div></div></div></div></div></foreignObject><text x="285" y="2709" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">Prometheus (Metrics Collection)</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-82"><g transform="translate(0.5,0.5)"><rect x="20" y="2720" width="530" height="160" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 520px; height: 1px; padding-top: 2800px; margin-left: 26px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 156px; overflow: hidden; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">- Scrapes /metrics from: app &amp; workers</span></div><div>- Metrics collected:</div><div>  - HTTP request latency &amp; throughput</div><div>  - Agent run / step execution metrics</div><div>  - Tool invocation metrics</div><div>  - LLM token usage &amp; cost</div><div>  - LLM provider health / circuit breaker states</div><div>  - Job processing metrics</div><div>  - Job queue depths</div><div>  - System health status</div></div></div></div></foreignObject><text x="26" y="2804" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">- Scrapes /metrics from: app &amp; workers...</text></switch></g></g></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-83"><g transform="translate(0.5,0.5)"><path d="M 20 2570 L 20 2540 L 550 2540 L 550 2570" fill="#f3f3f3" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(243, 243, 243), rgb(28, 28, 28)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 20 2570 L 20 2680 L 550 2680 L 550 2570" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 20 2570 L 550 2570" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 528px; height: 1px; padding-top: 2555px; margin-left: 21px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style="text-align: left;"><div><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"><b>Grafana (Dashboards)</b></span></div></div></div></div></div></foreignObject><text x="285" y="2559" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">Grafana (Dashboards)</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-84"><g transform="translate(0.5,0.5)"><rect x="20" y="2570" width="530" height="110" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 520px; height: 1px; padding-top: 2625px; margin-left: 26px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 106px; overflow: hidden; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">- Dashboards for:</span></div><div>  - HTTP request metrics</div><div>  - Agent run statistics (runs/steps)</div><div>  - Job processing &amp; queue metrics</div><div>  - Tool invocation stats</div><div>  - LLM provider health &amp; circuit breaker states</div><div>  - System / component health status</div></div></div></div></foreignObject><text x="26" y="2629" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">- Dashboards for:...</text></switch></g></g></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-85"><g transform="translate(0.5,0.5)"><path d="M 20 2230 L 20 2200 L 550 2200 L 550 2230" fill="#f3f3f3" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(243, 243, 243), rgb(28, 28, 28)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 20 2230 L 20 2350 L 550 2350 L 550 2230" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 20 2230 L 550 2230" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 528px; height: 1px; padding-top: 2215px; margin-left: 21px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style="text-align: left;"><b>Instrumentation &amp; Endpoints</b></div></div></div></div></foreignObject><text x="285" y="2219" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">Instrumentation &amp; Endpoints</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-86"><g transform="translate(0.5,0.5)"><rect x="20" y="2230" width="530" height="120" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 520px; height: 1px; padding-top: 2290px; margin-left: 26px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 116px; overflow: hidden; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">- Prometheus /metrics endpoint (exposed by app &amp; workers)</span></div><div>- OpenTelemetry tracing (OTLP export from app &amp; workers)</div><div>- Structured logging (JSON format)</div><div>- Health endpoints:</div><div>  - /v1/health/live</div><div>  - /v1/health/ready</div><div>  - /v1/health/startup</div><div>  - /v1/health/components</div></div></div></div></foreignObject><text x="26" y="2294" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">- Prometheus /metrics endpoint (exposed by app &amp; workers)...</text></switch></g></g></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-87"><g transform="translate(0.5,0.5)"><path d="M 20 2390 L 20 2360 L 550 2360 L 550 2390" fill="#f3f3f3" stroke="#000000" stroke-miterlimit="10" pointer-events="all" style="fill: light-dark(rgb(243, 243, 243), rgb(28, 28, 28)); stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 20 2390 L 20 2530 L 550 2530 L 550 2390" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/><path d="M 20 2390 L 550 2390" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none" style="stroke: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 528px; height: 1px; padding-top: 2375px; margin-left: 21px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div style="text-align: left;"><div><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));"><b>Tracing (OTel Collector + APM Backend)</b></span></div></div></div></div></div></foreignObject><text x="285" y="2379" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px" text-anchor="middle">Tracing (OTel Collector + APM Backend)</text></switch></g></g><g data-cell-id="-zAXcNhFpfNaQYtVMxQg-88"><g transform="translate(0.5,0.5)"><rect x="20" y="2390" width="530" height="140" fill="none" stroke="none" pointer-events="all"/></g><g><g><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 520px; height: 1px; padding-top: 2460px; margin-left: 26px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 136px; overflow: hidden; color: #000000; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: light-dark(#000000, #ffffff); line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><div><span style="background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));">- OTel Collector / APM:</span></div><div>  - Receives OTLP traces from: app &amp; workers</div><div>  - Exports to: Jaeger / Tempo / APM backend</div><div>- Trace spans include:</div><div>  - Agent run execution (end-to-end)</div><div>  - Step-by-step processing</div><div>  - Tool invocations</div><div>  - Database queries</div><div>  - Job lifecycle (enqueue → execute → complete/fail/cancel)</div><div><br /></div></div></div></div></foreignObject><text x="26" y="2464" fill="light-dark(#000000, #ffffff)" font-family="Helvetica" font-size="12px">- OTel Collector / APM:...</text></switch></g></g></g></g></g></g></g></g></g></svg>
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=5,IE=9" ><![endif]-->
<!DOCTYPE html>
<html>
<head>
<title>DIAGRAM_WORKFLOW_B</title>
<meta charset="utf-8"/>
</head>
<body><div class="mxgraph" style="max-width:100%;border:1px solid transparent;" data-mxgraph="{&quot;highlight&quot;:&quot;#0000ff&quot;,&quot;nav&quot;:true,&quot;resize&quot;:true,&quot;dark-mode&quot;:&quot;auto&quot;,&quot;toolbar&quot;:&quot;zoom layers tags lightbox&quot;,&quot;edit&quot;:&quot;_blank&quot;,&quot;xml&quot;:&quot;&lt;mxfile host=\&quot;app.diagrams.net\&quot; agent=\&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36\&quot; version=\&quot;29.3.4\&quot;&gt;\n  &lt;diagram name=\&quot;Page-1\&quot; id=\&quot;o7U-nxtfvU7QnVVJ9hKv\&quot;&gt;\n    &lt;mxGraphModel dx=\&quot;6780\&quot; dy=\&quot;3580\&quot; grid=\&quot;1\&quot; gridSize=\&quot;10\&quot; guides=\&quot;1\&quot; tooltips=\&quot;1\&quot; connect=\&quot;1\&quot; arrows=\&quot;1\&quot; fold=\&quot;1\&quot; page=\&quot;1\&quot; pageScale=\&quot;1\&quot; pageWidth=\&quot;850\&quot; pageHeight=\&quot;1100\&quot; background=\&quot;#ffffff\&quot; math=\&quot;0\&quot; shadow=\&quot;0\&quot;&gt;\n      &lt;root&gt;\n        &lt;mxCell id=\&quot;0\&quot; /&gt;\n        &lt;mxCell id=\&quot;1\&quot; parent=\&quot;0\&quot; /&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-75\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;HJKx42f4Jz2vHTe7KREf-90\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeColor=default;\&quot; target=\&quot;EiYPZZWAnG0CHaq9ObTb-10\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;HJKx42f4Jz2vHTe7KREf-90\&quot; parent=\&quot;1\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;startSize=40;fillColor=#E0DDEF;strokeColor=default;\&quot; value=\&quot;&amp;lt;div&amp;gt;IDENTITY &amp;amp;amp; AUTHENTICATION LAYER:&amp;amp;nbsp;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;CLIENTS &amp;amp;amp; USER INTERFACES&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;550\&quot; width=\&quot;570\&quot; x=\&quot;-690\&quot; y=\&quot;135\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;mxRectangle height=\&quot;30\&quot; width=\&quot;140\&quot; x=\&quot;470\&quot; y=\&quot;210\&quot; as=\&quot;alternateBounds\&quot; /&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;HJKx42f4Jz2vHTe7KREf-6\&quot; parent=\&quot;HJKx42f4Jz2vHTe7KREf-90\&quot; style=\&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;fillColor=#F3F0FF;strokeColor=default;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;b&amp;gt;Identity Provider (OIDC / Auth0)&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;160\&quot; width=\&quot;550\&quot; x=\&quot;10\&quot; y=\&quot;50\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;HJKx42f4Jz2vHTe7KREf-7\&quot; parent=\&quot;HJKx42f4Jz2vHTe7KREf-6\&quot; style=\&quot;text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;div&amp;gt;- OAuth 2.0 login flow&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- JWT tokens (tenant_id, sub, roles[], scopes[], exp, iat)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- JWKS endpoint for token verification&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Token refresh &amp;amp;amp; revocation&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Principal:&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;sub, tenant_id,&amp;amp;nbsp;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;roles: [admin, operator, user, viewer],&amp;amp;nbsp;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;scopes: [read, write, graph:read, ...]&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;130\&quot; width=\&quot;550\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;HJKx42f4Jz2vHTe7KREf-14\&quot; parent=\&quot;HJKx42f4Jz2vHTe7KREf-90\&quot; style=\&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#F3F0FF;strokeColor=default;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;Reverse Proxy / API Gateway (NGINX)&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;90\&quot; width=\&quot;550\&quot; x=\&quot;10\&quot; y=\&quot;450\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;HJKx42f4Jz2vHTe7KREf-15\&quot; parent=\&quot;HJKx42f4Jz2vHTe7KREf-14\&quot; style=\&quot;text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;-&amp;amp;nbsp;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent;&amp;quot;&amp;gt;TLS termination (HTTPS)&amp;amp;nbsp;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Routing to backend services&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- CORS handling&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;-&amp;amp;nbsp;Load balancing&amp;amp;nbsp;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;60\&quot; width=\&quot;550\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;jL9Ayfw5SwNCbvacDRDm-101\&quot; parent=\&quot;HJKx42f4Jz2vHTe7KREf-90\&quot; style=\&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#F3F0FF;strokeColor=default;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;Control Panel UI (Streamlit)&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;220\&quot; width=\&quot;550\&quot; x=\&quot;10\&quot; y=\&quot;220\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;jL9Ayfw5SwNCbvacDRDm-102\&quot; parent=\&quot;jL9Ayfw5SwNCbvacDRDm-101\&quot; style=\&quot;text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;div&amp;gt;&amp;lt;div&amp;gt;[LONG-RUNNING JOBS -&amp;amp;nbsp;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;WORKFLOW B&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;]&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Admin/Operator dashboard&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Jobs, models, tools management&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Graph/NL-&amp;amp;gt;Cypher experiments&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- SSE streaming for job events&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- ETL, backup, maintenance triggers&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent;&amp;quot;&amp;gt;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;POST /v1/jobs&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;- Bearer JWT, type, payload&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;- Job Types: demo, test, long-running, agent.run&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;- Returns: {id, status, created_at}&amp;lt;/div&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;190\&quot; width=\&quot;550\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;jL9Ayfw5SwNCbvacDRDm-104\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;EiYPZZWAnG0CHaq9ObTb-1\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=default;\&quot; target=\&quot;jL9Ayfw5SwNCbvacDRDm-99\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-1\&quot; parent=\&quot;1\&quot; style=\&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#D7E4D7;strokeColor=default;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;API LAYER (Routers)&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;240\&quot; width=\&quot;570\&quot; x=\&quot;-690\&quot; y=\&quot;725\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-2\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-1\&quot; style=\&quot;text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;div&amp;gt;- /v1/health&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Health probes (live, ready, startup, components)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- /v1/auth&amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Token introspection, identity verification&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- /v1/agents&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;- Agent definitions and configurations&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- /v1/agent-runs - Agent run lifecycle (create, poll, cancel)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- /v1/tools&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- MCP tool registry and invocation&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- /v1/jobs&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Async job lifecycle (create, stream, cancel)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- /v1/models&amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Model and provider management&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- /v1/admin&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Administrative operations&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- /v1/tenants&amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Multi-tenant configuration&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- /v1/sessions&amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Session management&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- /v1/graph&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Graph query endpoints&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- /v1/batch&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Batch operations&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- /v1/export&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Data export utilities&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- /v1/internal&amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Internal diagnostics&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;210\&quot; width=\&quot;570\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-81\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;EiYPZZWAnG0CHaq9ObTb-5\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeColor=default;\&quot; target=\&quot;EiYPZZWAnG0CHaq9ObTb-29\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-5\&quot; parent=\&quot;1\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;fillColor=#EBDFBC;strokeColor=default;\&quot; value=\&quot;&amp;lt;div&amp;gt;SERVICE LAYER&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;700\&quot; width=\&quot;570\&quot; x=\&quot;-40\&quot; y=\&quot;1235\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-6\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-5\&quot; style=\&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#FFF2CC;strokeColor=default;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;b&amp;gt;ORCHESTRATOR&amp;amp;nbsp;&amp;lt;/b&amp;gt;&amp;lt;b&amp;gt;SERVICE&amp;lt;/b&amp;gt;&amp;lt;b&amp;gt;: 1 Run per prompt,&amp;amp;nbsp;&amp;lt;/b&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; text-align: center;&amp;quot;&amp;gt;&amp;lt;b&amp;gt;4 Phases&amp;lt;/b&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;500\&quot; width=\&quot;550\&quot; x=\&quot;10\&quot; y=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-7\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-6\&quot; style=\&quot;text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;PHASE 1) INTENT CLASSIFICATION:&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- A&amp;lt;span style=&amp;quot;background-color: transparent;&amp;quot;&amp;gt;nalyzes prompt via LLM&amp;lt;br&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent;&amp;quot;&amp;gt;- Check params.category → Match prompt catalog → Apply classify_intent()&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;:&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - CHAT - Conversational responses&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - GRAPH - Analytics, NL-&amp;amp;gt;Cypher queries&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - SECURITY - Security/permissions questions&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - ADMIN - Administrative write operations&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - DANGEROUS - Destructive ops → refuse + offer EXPLAIN&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - EXPLAIN - EXPLAIN-only query analysis&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent;&amp;quot;&amp;gt;&amp;lt;b&amp;gt;PHASE 2) TODO Planning&amp;lt;/b&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;b&amp;gt;&amp;amp;nbsp;(multi-step run):&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;- LLM-based planning&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;- Input: Goal + Context + Schema → Output: TODO Array&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;- Planning Modes: full (LLM per TODO) | optional (try direct) | none (deterministic)&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;PHASE 3) Step Execution,&amp;amp;nbsp;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;FOR EACH TODO&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;:&amp;lt;/span&amp;gt;&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; 1. Call LLM Provider (planner, reflector, responder)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; 2. Invoke MCP Tools with RBAC check (34 tools available)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; 3. If GRAPH mode: NL-&amp;amp;gt;Cypher pipeline&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; 4. Persist step → PostgreSQL&amp;amp;nbsp;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;(via adaptor)&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; 5. Use Redis for session/cache/cancel&amp;amp;nbsp;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;(via adaptor)&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Step records: {id, action, input, output, latency_ms, started_at, finished_at}&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;PHASE 4)&amp;amp;nbsp;&amp;lt;/b&amp;gt;&amp;lt;b style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;Finalization &amp;amp;amp;&amp;amp;nbsp;&amp;lt;/b&amp;gt;&amp;lt;b style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;Response Generation&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;div&amp;gt;- build_response() → Orchestration Result&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Response mode selection: fallback-only | llm-best-effort&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Canonical output structure: {goal, steps[], outputs[], todos[], metrics}&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Normalize final output: text + optional JSON payload&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Safety/compliance: PII scrubbing + output guard checks&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Persist final state + metrics → PostgreSQL&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Observability: emit Prometheus metrics + OpenTelemetry traces&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;470\&quot; width=\&quot;550\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-8\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-5\&quot; style=\&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#FFF2CC;strokeColor=default;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;b&amp;gt;ADDITIONAL SERVICES&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;120\&quot; width=\&quot;550\&quot; x=\&quot;10\&quot; y=\&quot;560\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-9\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-8\&quot; style=\&quot;text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;- Session Service (state management)&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Job Service (job lifecycle)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Default Model Resolver&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Health / ETL / Archive Services&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Invocation Store (audit trail)&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;90\&quot; width=\&quot;550\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-77\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;EiYPZZWAnG0CHaq9ObTb-10\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.75;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;strokeColor=default;\&quot; target=\&quot;EiYPZZWAnG0CHaq9ObTb-2\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-10\&quot; parent=\&quot;1\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;fillColor=#EAD6D6;strokeColor=default;rounded=0;absoluteArcSize=0;swimlaneFillColor=none;fillStyle=solid;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;b&amp;gt;SECURITY&amp;amp;nbsp;&amp;lt;/b&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; text-align: center;&amp;quot;&amp;gt;MIDDLEWARE STACK&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;1050\&quot; width=\&quot;930\&quot; x=\&quot;-40\&quot; y=\&quot;135\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-11\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-10\&quot; style=\&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;fillColor=#FFE9E9;strokeColor=default;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;1. CORS Handler - Cross-Origin Resource Sharing policy enforcement&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;90\&quot; width=\&quot;910\&quot; x=\&quot;10\&quot; y=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-12\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-11\&quot; style=\&quot;text;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;strokeColor=default;\&quot; value=\&quot;&amp;lt;div&amp;gt;- Allowed origins, methods, headers configuration&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Preflight OPTIONS request handling&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Credentials and expose headers support&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;60\&quot; width=\&quot;910\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-13\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-10\&quot; style=\&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;fillColor=#FFE9E9;strokeColor=default;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;2. Trace Context - OpenTelemetry distributed tracing context&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;90\&quot; width=\&quot;910\&quot; x=\&quot;10\&quot; y=\&quot;140\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-14\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-13\&quot; style=\&quot;text;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;strokeColor=default;\&quot; value=\&quot;&amp;lt;div&amp;gt;- Injects/extracts W3C trace-context headers (traceparent, tracestate)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Creates root span if missing, propagates existing trace&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Adds trace_id, span_id, parent_id to request context&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;60\&quot; width=\&quot;910\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-15\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-10\&quot; style=\&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;fillColor=#FFE9E9;strokeColor=default;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;3. Auth JWT - JWT/OIDC token validation and principal extraction&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;110\&quot; width=\&quot;910\&quot; x=\&quot;10\&quot; y=\&quot;240\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-16\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-15\&quot; style=\&quot;text;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;strokeColor=default;\&quot; value=\&quot;&amp;lt;div&amp;gt;- Validates Bearer token via JWKS endpoint (RS256/RS384/RS512)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Extracts claims: sub, tenant_id, roles[], scopes[], exp, iat&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;div&amp;gt;- RBAC &amp;amp;amp; Scope Enforcement for endpoints&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Builds Principal object for downstream authorization&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp;- Rejects expired/invalid/malformed tokens with 401 Unauthorized&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;80\&quot; width=\&quot;910\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-17\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-10\&quot; style=\&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;fillColor=#FFE9E9;strokeColor=default;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;4. Rate Limit - Redis-backed rate limiting with multiple dimensions&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;110\&quot; width=\&quot;910\&quot; x=\&quot;10\&quot; y=\&quot;470\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-18\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-17\&quot; style=\&quot;text;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;strokeColor=default;\&quot; value=\&quot;&amp;lt;div&amp;gt;- Per-user limits: ratelimit:user:{sub}&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Per-tenant limits: ratelimit:tenant:{tenant_id}&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Per-endpoint limits: ratelimit:endpoint:{method}:{path}&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp;- Sliding window algorithm, returns 429 Too Many Requests when exceeded&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp;- X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Reset headers&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;80\&quot; width=\&quot;910\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-19\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-10\&quot; style=\&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;fillColor=#FFE9E9;strokeColor=default;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;5. Tenant Resolver - Multi-tenancy isolation and context resolution&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;100\&quot; width=\&quot;910\&quot; x=\&quot;10\&quot; y=\&quot;600\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-20\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-19\&quot; style=\&quot;text;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;strokeColor=default;\&quot; value=\&quot;&amp;lt;div&amp;gt;- Resolves tenant configuration from Redis cache or PostgreSQL&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Injects tenant_id filter into all database queries&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Enforces data isolation between tenants&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp;- Loads tenant-specific settings (model defaults, feature flags)&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;70\&quot; width=\&quot;910\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-21\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-10\&quot; style=\&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;fillColor=#FFE9E9;strokeColor=default;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;6. Input Guard - Request payload validation and sanitization&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;100\&quot; width=\&quot;910\&quot; x=\&quot;10\&quot; y=\&quot;710\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-22\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-21\&quot; style=\&quot;text;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;strokeColor=default;\&quot; value=\&quot;&amp;lt;div&amp;gt;- Pydantic schema validation for all request bodies&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Injection prevention (SQL, Cypher, command injection patterns)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Content-type validation and size limits&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp;- Malicious payload detection&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;70\&quot; width=\&quot;910\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-23\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-10\&quot; style=\&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;fillColor=#FFE9E9;strokeColor=default;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;b&amp;gt;7. Output Guard - Response sanitization and compliance&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;100\&quot; width=\&quot;910\&quot; x=\&quot;10\&quot; y=\&quot;820\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-24\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-23\&quot; style=\&quot;text;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;strokeColor=default;\&quot; value=\&quot;&amp;lt;div&amp;gt;- PII scrubbing (email redaction, phone masking, SSN removal)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Content filtering for sensitive data patterns&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Response size validation and truncation&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp;- Audit logging of all responses with correlation IDs&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;70\&quot; width=\&quot;910\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-25\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-10\&quot; style=\&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;fillColor=#FFE9E9;strokeColor=default;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;8. Error Handler - Centralized exception handling and error response formatting&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;100\&quot; width=\&quot;910\&quot; x=\&quot;10\&quot; y=\&quot;930\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-26\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-25\&quot; style=\&quot;text;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;strokeColor=default;\&quot; value=\&quot;&amp;lt;div&amp;gt;- PII scrubbing (email redaction, phone masking, SSN removal)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Content filtering for sensitive data patterns&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Response size validation and truncation&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp;- Audit logging of all responses with correlation IDs&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;70\&quot; width=\&quot;910\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-27\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-10\&quot; style=\&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#FFE9E9;strokeColor=default;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;RBAC PERMISSION MATRIX&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;100\&quot; width=\&quot;910\&quot; x=\&quot;10\&quot; y=\&quot;360\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-28\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-27\&quot; style=\&quot;text;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;strokeColor=default;\&quot; value=\&quot;&amp;lt;div&amp;gt;- admin:&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;agent-runs=CRUD,&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;jobs=CRUD,&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;tools=CRUD,&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;tenants=CRUD,&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;graph(write)=✓&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- operator: &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;agent-runs=CRU,&amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;jobs=CRUD, &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;tools=R,&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;tenants=R,&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;graph(write)=✗&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- user:&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;agent-runs=CR,&amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;jobs=CRD,&amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;tools=R,&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;tenants=✗,&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;graph(write)=✗&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- viewer:&amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;agent-runs=R,&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;jobs=R,&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;tools=R,&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;tenants=✗,&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;graph(write)=✗&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;70\&quot; width=\&quot;910\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-82\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;EiYPZZWAnG0CHaq9ObTb-29\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=default;\&quot; target=\&quot;EiYPZZWAnG0CHaq9ObTb-43\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-29\&quot; parent=\&quot;1\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;fillColor=#EBDED4;strokeColor=default;\&quot; value=\&quot;&amp;lt;b style=&amp;quot;text-align: left;&amp;quot;&amp;gt;PHASE 3: Step Execution,&amp;amp;nbsp;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;FOR EACH TODO&amp;lt;/span&amp;gt;&amp;lt;/b&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;855\&quot; width=\&quot;930\&quot; x=\&quot;610\&quot; y=\&quot;1235\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-30\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-29\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;fillColor=#FFF1E6;strokeColor=default;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent;&amp;quot;&amp;gt;Step 1) LLM PROVIDERS&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;230\&quot; width=\&quot;910\&quot; x=\&quot;10\&quot; y=\&quot;45\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-31\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-30\&quot; style=\&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#FFF1E6;strokeColor=default;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;OpenAI&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;80\&quot; width=\&quot;430\&quot; x=\&quot;10\&quot; y=\&quot;140\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-32\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-31\&quot; style=\&quot;text;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;strokeColor=default;\&quot; value=\&quot;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;- Cloud LLM API&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- GPT-4, GPT-3.5, etc.&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;50\&quot; width=\&quot;430\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-33\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-30\&quot; style=\&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#FFF1E6;strokeColor=default;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;Ollama (Local)&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;90\&quot; width=\&quot;890\&quot; x=\&quot;10\&quot; y=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-34\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-33\&quot; style=\&quot;text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;div&amp;gt;&amp;lt;div&amp;gt;- Local LLM hosting&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Self-hosted models:&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;(phi3:mini,&amp;amp;nbsp;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;Mistral,&amp;amp;nbsp;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;LLaMA,&amp;amp;nbsp;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;Qwen,&amp;amp;nbsp;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;Gemma)&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;60\&quot; width=\&quot;890\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-35\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-30\&quot; style=\&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;fillColor=#FFF1E6;strokeColor=default;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;b&amp;gt;Azure OpenAI / Other Providers&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;80\&quot; width=\&quot;450\&quot; x=\&quot;450\&quot; y=\&quot;140\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-36\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-35\&quot; style=\&quot;text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;- Compatible OpenAI-style APIs&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Enterprise deployments&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;50\&quot; width=\&quot;450\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-37\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-29\&quot; style=\&quot;swimlane;fontStyle=1;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#FFF1E6;strokeColor=default;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;Step 2) MCP RUNTIME &amp;amp;amp; TOOLS (34 Tools, 12 Categories)&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;370\&quot; width=\&quot;910\&quot; x=\&quot;10\&quot; y=\&quot;290\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-38\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-37\&quot; style=\&quot;text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;div&amp;gt;&amp;lt;div&amp;gt;- Tool Registry (PostgreSQL-backed manifests)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Tool Policies (RBAC per tool, required_scopes)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- MCP Runtime (ToolContext, audit logging)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Tool Invocation:&amp;amp;nbsp;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;Request → Schema Validation → RBAC Check → Execute → Audit Log&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;Tool Categories:&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- GRAPH&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- query, secure_query, generate_cypher, schema, explain&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- SECURITY &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- describe_principal, allowed_operations, validate&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- SYSTEM&amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- health, metrics, config, status&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- CACHE&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- get, set, delete, invalidate&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- CATALOG&amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- discover, describe, search&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- MODEL&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- list, info, warmup, switch&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- AGENT&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- context, history, state&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- ANALYTICS &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- query, aggregate, visualize&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- ADMIN&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- create_index, drop_index, constraint&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- ETL&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;/span&amp;gt;- import, export, transform&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- CRUD&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- create_node, update_node, delete_node&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- EXPORT&amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- csv, json, cypher&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;div&amp;gt;Tool Manifest (from PostgreSQL):&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;{name, description, input_schema, required_scopes,&amp;amp;nbsp;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;rate_limit: {requests: 100, window: 60}}&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;340\&quot; width=\&quot;910\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-39\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-29\&quot; style=\&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;fillColor=#FFF1E6;strokeColor=default;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;Step 3) NL&amp;amp;nbsp;&amp;lt;span style=&amp;quot;text-align: left;&amp;quot;&amp;gt;→&amp;lt;/span&amp;gt;&amp;amp;nbsp;CYPHER PIPELINE&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;160\&quot; width=\&quot;910\&quot; x=\&quot;10\&quot; y=\&quot;675\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-40\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-39\&quot; style=\&quot;text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;text-align: center;&amp;quot;&amp;gt;[In case of GRAPH mode]&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;text-align: center;&amp;quot;&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;div&amp;gt;1. Normalize NL prompt → standardize user question&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;2. Generate Cypher → LLM-based or test hints&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;3. Validate Safety → read-only enforcement, tenant boundaries, injection prevention&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;4. Execute on Memgraph → run validated Cypher query&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;5. Summarize Results → convert graph results to natural language&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;130\&quot; width=\&quot;910\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;jL9Ayfw5SwNCbvacDRDm-103\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;EiYPZZWAnG0CHaq9ObTb-43\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=default;\&quot; target=\&quot;jL9Ayfw5SwNCbvacDRDm-60\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-43\&quot; parent=\&quot;1\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;fillColor=light-dark(#D7ECE9,#EDEDED);strokeColor=default;\&quot; value=\&quot;&amp;lt;b style=&amp;quot;text-align: left;&amp;quot;&amp;gt;Step 4 &amp;amp;amp; 5)&amp;lt;/b&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;850\&quot; width=\&quot;930\&quot; x=\&quot;610\&quot; y=\&quot;2145\&quot; as=\&quot;geometry\&quot;&gt;\n            &lt;mxRectangle height=\&quot;30\&quot; width=\&quot;100\&quot; x=\&quot;540\&quot; y=\&quot;2570\&quot; as=\&quot;alternateBounds\&quot; /&gt;\n          &lt;/mxGeometry&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-44\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-43\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;strokeColor=default;fillColor=#EAFFFB;\&quot; value=\&quot;ADAPTERS &amp;amp;amp; RESILIENCE FRAMEWORK\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;320\&quot; width=\&quot;910\&quot; x=\&quot;10\&quot; y=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-45\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-44\&quot; style=\&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;strokeColor=default;fillColor=#EAFFFB;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;b&amp;gt;LLM Adapters&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;110\&quot; width=\&quot;333.75\&quot; x=\&quot;16.25\&quot; y=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-46\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-45\&quot; style=\&quot;text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;- Ollama adapter (local LLMs)&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;- OpenAI-style API adapter&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Stub/Demo adapter (testing)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Azure OpenAI adapter&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;80\&quot; width=\&quot;333.75\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-47\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-44\&quot; style=\&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;strokeColor=default;fillColor=#EAFFFB;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;b&amp;gt;Resilience Mechanisms&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;110\&quot; width=\&quot;540\&quot; x=\&quot;360\&quot; y=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-48\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-47\&quot; style=\&quot;text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;div&amp;gt;- Circuit Breaker States per provider:&amp;amp;nbsp;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;CLOSED (normal) → OPEN (reject) → HALF_OPEN (test one) → CLOSED&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;- Automatic Retries with exponential backoff&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Cost Tracking per provider/model&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Provider Fallback chain&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;80\&quot; width=\&quot;540\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-49\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-44\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;strokeColor=default;fillColor=#EAFFFB;\&quot; value=\&quot;Database Adapters\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;150\&quot; width=\&quot;883.75\&quot; x=\&quot;16.25\&quot; y=\&quot;160\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-50\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-49\&quot; style=\&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;strokeColor=default;fillColor=#EAFFFB;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;Redis Adapter&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;100\&quot; width=\&quot;80\&quot; x=\&quot;93.75\&quot; y=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-51\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-50\&quot; style=\&quot;text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;- cache&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;- queues&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;- rate limits&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;70\&quot; width=\&quot;80\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-52\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-49\&quot; style=\&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;strokeColor=default;fillColor=#EAFFFB;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;b&amp;gt;PostgreSQL Adapter&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;100\&quot; width=\&quot;90\&quot; x=\&quot;403.75\&quot; y=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-53\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-52\&quot; style=\&quot;text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;- repositories&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;- transactions&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;70\&quot; width=\&quot;90\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-54\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-49\&quot; style=\&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;strokeColor=default;fillColor=#EAFFFB;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;Memgraph Adapter&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;100\&quot; width=\&quot;100\&quot; x=\&quot;693.75\&quot; y=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-55\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-54\&quot; style=\&quot;text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;- graph queries&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;- NL-&amp;amp;gt;Cypher&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;70\&quot; width=\&quot;100\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-56\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-43\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;strokeColor=default;fillColor=#EADFE9;\&quot; value=\&quot;DATA &amp;amp;amp; INFRASTRUCTURE LAYER\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;460\&quot; width=\&quot;910\&quot; x=\&quot;10\&quot; y=\&quot;380\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-57\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-56\&quot; style=\&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;strokeColor=default;fillColor=#EADFE9;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;b&amp;gt;PostgreSQL&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;240\&quot; width=\&quot;280\&quot; x=\&quot;330\&quot; y=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-58\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-57\&quot; style=\&quot;text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;Tables:&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- tenants&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Multi-tenant configurations&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- agent_runs&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Agent run records with status&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- steps&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Per-step execution records&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- sessions&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- User session state&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- jobs&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;/span&amp;gt;- Async job records&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- job_events&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Job progress events&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- tool_manifests&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- MCP tool definitions&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- model_defaults&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Default model configurations&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- audit_logs&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- All action audit trail&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;SQLAlchemy + Alembic migrations&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;Used by: App (Background Tasks)&amp;amp;nbsp;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;+ Workers&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;210\&quot; width=\&quot;280\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-59\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-56\&quot; style=\&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;strokeColor=default;fillColor=#EADFE9;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;Memgraph (Graph Database)&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;410\&quot; width=\&quot;280\&quot; x=\&quot;620\&quot; y=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-60\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-59\&quot; style=\&quot;text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;&amp;lt;b&amp;gt;Nodes:&amp;lt;/b&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- (:User&amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;/span&amp;gt;{id, name, email})&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- (:Task &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;/span&amp;gt;{id, title, status})&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- (:File &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;/span&amp;gt;{id, name, path})&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- (:Institution &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;{id, name})&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- (:Project &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;{id, name})&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;Relationships:&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- (User)-[:ASSIGNED_TO]-&amp;amp;gt;(Task)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- (User)-[:OWNS]-&amp;amp;gt;(File)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- (User)-[:BELONGS_TO]-&amp;amp;gt;(Institution)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- (Task)-[:PART_OF]-&amp;amp;gt;(Project)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- (File)-[:ATTACHED_TO]-&amp;amp;gt;(Task)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;NL-&amp;amp;gt;Cypher Pipeline Components:&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- NL normalization (standardize user question)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Cypher generation (LLM-based or test hints)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Safety validation (read-only, tenant boundaries, injection prevention)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Query execution (run validated Cypher)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Result summarization (convert to natural language)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;Used by: NL-&amp;amp;gt;Cypher, graph.* tools, analytics,&amp;amp;nbsp;ETL jobs&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;380\&quot; width=\&quot;280\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-61\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-56\&quot; style=\&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;strokeColor=default;fillColor=#EADFE9;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;b&amp;gt;Redis (Cache &amp;amp;amp; Queues)&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;330\&quot; width=\&quot;310\&quot; x=\&quot;10\&quot; y=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-62\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-61\&quot; style=\&quot;text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;&amp;lt;b&amp;gt;CACHE:&amp;lt;/b&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- session:{id}&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;/span&amp;gt;- Session data&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- tenant:config:{id}&amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Tenant configurations&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- model:defaults:{id} &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Model defaults&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;QUEUES:&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- jobs:queue:{type}&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Job queue (LPUSH/BRPOP)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- jobs:events:{id}&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- SSE event buffer (ring)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- jobs:state:{id}&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Job state (HASH)&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;RATE LIMITING:&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- ratelimit:user:{id}&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Per-user limits&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- ratelimit:tenant:{id}&amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Per-tenant limits&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- ratelimit:endpoint:{}&amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Per-endpoint limits&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;CONTROL:&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- idempotency:{key}&amp;amp;nbsp; &amp;amp;nbsp; &amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;- Idempotency mapping&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- circuit:{provider}&amp;amp;nbsp; &amp;amp;nbsp;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;span style=&amp;quot;white-space: pre;&amp;quot;&amp;gt;&amp;#x9;&amp;lt;/span&amp;gt;&amp;lt;/span&amp;gt;- Circuit breaker state&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;Used by: App (Background Tasks) + Workers&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;300\&quot; width=\&quot;310\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-85\&quot; parent=\&quot;1\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;fillColor=#E0E0E0;fontColor=#333333;strokeColor=default;\&quot; value=\&quot;&amp;lt;b style=&amp;quot;text-align: left;&amp;quot;&amp;gt;BACKGROUND FRAMEWORK&amp;lt;/b&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;900\&quot; width=\&quot;570\&quot; x=\&quot;-40\&quot; y=\&quot;1965\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-72\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-85\&quot; style=\&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#F3F3F3;fontColor=#333333;strokeColor=default;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;APScheduler&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;110\&quot; width=\&quot;550\&quot; x=\&quot;10\&quot; y=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-73\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-72\&quot; style=\&quot;text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;div&amp;gt;Scheduled Tasks&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Health check (30s): Postgres ping, Redis ping, Memgraph ping, LLM warmup/availability&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Cleanup (hourly): stale/old sessions, expired/stale cache, expired jobs, old job records, orphan runs&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Backup (daily): PostgreSQL dump, Redis RDB snapshot, Memgraph archives, audit logs export&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Provider monitoring: provider health + metrics emission&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;80\&quot; width=\&quot;550\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-63\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-85\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;fillColor=#E0E0E0;fontColor=#333333;strokeColor=default;\&quot; value=\&quot;&amp;lt;b style=&amp;quot;text-align: left;&amp;quot;&amp;gt;OBSERVABILITY &amp;amp;amp; MONITORING&amp;lt;/b&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;730\&quot; width=\&quot;550\&quot; x=\&quot;10\&quot; y=\&quot;160\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-64\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-63\&quot; style=\&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#F3F3F3;fontColor=#333333;strokeColor=default;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;&amp;lt;b&amp;gt;Prometheus (Metrics Collection)&amp;lt;/b&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;190\&quot; width=\&quot;530\&quot; x=\&quot;10\&quot; y=\&quot;530\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-65\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-64\&quot; style=\&quot;text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;- Scrapes /metrics from: app &amp;amp;amp; workers&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Metrics collected:&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - HTTP request latency &amp;amp;amp; throughput&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - Agent run / step execution metrics&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - Tool invocation metrics&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - LLM token usage &amp;amp;amp; cost&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - LLM provider health / circuit breaker states&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - Job processing metrics&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - Job queue depths&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - System health status&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;160\&quot; width=\&quot;530\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-66\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-63\&quot; style=\&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#F3F3F3;fontColor=#333333;strokeColor=default;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;&amp;lt;b&amp;gt;Grafana (Dashboards)&amp;lt;/b&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;140\&quot; width=\&quot;530\&quot; x=\&quot;10\&quot; y=\&quot;380\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-67\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-66\&quot; style=\&quot;text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;- Dashboards for:&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - HTTP request metrics&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - Agent run statistics (runs/steps)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - Job processing &amp;amp;amp; queue metrics&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - Tool invocation stats&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - LLM provider health &amp;amp;amp; circuit breaker states&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - System / component health status&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;110\&quot; width=\&quot;530\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-68\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-63\&quot; style=\&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#F3F3F3;fontColor=#333333;strokeColor=default;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;b&amp;gt;Instrumentation &amp;amp;amp; Endpoints&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;150\&quot; width=\&quot;530\&quot; x=\&quot;10\&quot; y=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-69\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-68\&quot; style=\&quot;text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;- Prometheus /metrics endpoint (exposed by app &amp;amp;amp; workers)&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- OpenTelemetry tracing (OTLP export from app &amp;amp;amp; workers)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Structured logging (JSON format)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Health endpoints:&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - /v1/health/live&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - /v1/health/ready&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - /v1/health/startup&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - /v1/health/components&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;120\&quot; width=\&quot;530\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-70\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-63\&quot; style=\&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#F3F3F3;fontColor=#333333;strokeColor=default;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;&amp;lt;b&amp;gt;Tracing (OTel Collector + APM Backend)&amp;lt;/b&amp;gt;&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;170\&quot; width=\&quot;530\&quot; x=\&quot;10\&quot; y=\&quot;200\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;EiYPZZWAnG0CHaq9ObTb-71\&quot; parent=\&quot;EiYPZZWAnG0CHaq9ObTb-70\&quot; style=\&quot;text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;- OTel Collector / APM:&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - Receives OTLP traces from: app &amp;amp;amp; workers&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - Exports to: Jaeger / Tempo / APM backend&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Trace spans include:&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - Agent run execution (end-to-end)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - Step-by-step processing&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - Tool invocations&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - Database queries&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; - Job lifecycle (enqueue → execute → complete/fail/cancel)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;140\&quot; width=\&quot;530\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;jL9Ayfw5SwNCbvacDRDm-108\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;jL9Ayfw5SwNCbvacDRDm-99\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=default;\&quot; target=\&quot;jL9Ayfw5SwNCbvacDRDm-20\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;jL9Ayfw5SwNCbvacDRDm-99\&quot; parent=\&quot;1\&quot; style=\&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#EAF7EA;strokeColor=default;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;[&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;LONG-RUNNING JOB ENDPOINTS&amp;lt;/span&amp;gt;]&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;100\&quot; width=\&quot;570\&quot; x=\&quot;-690\&quot; y=\&quot;1085\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;jL9Ayfw5SwNCbvacDRDm-100\&quot; parent=\&quot;jL9Ayfw5SwNCbvacDRDm-99\&quot; style=\&quot;text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;div&amp;gt;&amp;lt;span style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;- POST /v1/jobs → HTTP 202 + Location header&amp;lt;/span&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- GET /v1/jobs/{id}&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- GET /v1/jobs/{id}/events (SSE streaming)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- DELETE /v1/jobs/{id} (cancellation via Redis Lua script)&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;70\&quot; width=\&quot;570\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;jL9Ayfw5SwNCbvacDRDm-107\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;jL9Ayfw5SwNCbvacDRDm-20\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=default;\&quot; target=\&quot;jL9Ayfw5SwNCbvacDRDm-93\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;jL9Ayfw5SwNCbvacDRDm-20\&quot; parent=\&quot;1\&quot; style=\&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#D7DEEB;strokeColor=default;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b&amp;gt;JOB CREATION &amp;amp;amp; ENQUEUE&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;210\&quot; width=\&quot;570\&quot; x=\&quot;-690\&quot; y=\&quot;1235\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;jL9Ayfw5SwNCbvacDRDm-21\&quot; parent=\&quot;jL9Ayfw5SwNCbvacDRDm-20\&quot; style=\&quot;text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;div&amp;gt;JOB CREATION FLOW:&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Validate job request (Pydantic schema)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Validate payload against JSON Schema for job type&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Check idempotency key (Redis + PostgreSQL)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Create Job record (status=queued) → PostgreSQL&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- LPUSH job_id → Redis queue: jobs:queue:{type}&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- HSET job state → Redis: jobs:state:{id}&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Cache idempotency mapping → Redis&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Return HTTP 202 + JobResponse {id, status, created_at} + Location header&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Job Types: demo, test, long-running, agent.run&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;Redis Queue (Job IDs) → To Workers via BRPOP&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;180\&quot; width=\&quot;570\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;jL9Ayfw5SwNCbvacDRDm-106\&quot; edge=\&quot;1\&quot; parent=\&quot;1\&quot; source=\&quot;jL9Ayfw5SwNCbvacDRDm-93\&quot; style=\&quot;edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeColor=default;\&quot; target=\&quot;EiYPZZWAnG0CHaq9ObTb-5\&quot;&gt;\n          &lt;mxGeometry relative=\&quot;1\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;jL9Ayfw5SwNCbvacDRDm-93\&quot; parent=\&quot;1\&quot; style=\&quot;swimlane;whiteSpace=wrap;html=1;fillColor=#D6E4EB;strokeColor=default;\&quot; value=\&quot;WORKERS\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;710\&quot; width=\&quot;570\&quot; x=\&quot;-690\&quot; y=\&quot;1495\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;jL9Ayfw5SwNCbvacDRDm-94\&quot; parent=\&quot;jL9Ayfw5SwNCbvacDRDm-93\&quot; style=\&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#E9F7FF;strokeColor=default;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;b&amp;gt;SSE STREAMING TO CONTROL PANEL&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;90\&quot; width=\&quot;550\&quot; x=\&quot;10\&quot; y=\&quot;610\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;jL9Ayfw5SwNCbvacDRDm-95\&quot; parent=\&quot;jL9Ayfw5SwNCbvacDRDm-94\&quot; style=\&quot;text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;div&amp;gt;- Control Panel subscribes: GET /v1/jobs/{id}/events (Server-Sent Events)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Backend streams events from PostgreSQL + Redis buffer&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- UI displays: real-time progress, logs, final status&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;60\&quot; width=\&quot;550\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;jL9Ayfw5SwNCbvacDRDm-96\&quot; parent=\&quot;jL9Ayfw5SwNCbvacDRDm-93\&quot; style=\&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#E9F7FF;strokeColor=default;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;b&amp;gt;Job Processing Worker&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;560\&quot; width=\&quot;550\&quot; x=\&quot;10\&quot; y=\&quot;40\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;jL9Ayfw5SwNCbvacDRDm-97\&quot; parent=\&quot;jL9Ayfw5SwNCbvacDRDm-96\&quot; style=\&quot;text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;div&amp;gt;WORKER PROCESSING LOOP FOR EACH JOB:&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;1. Pop job ID: BRPOP jobs:queue:{type} (blocking wait)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;2. Load job metadata from PostgreSQL&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;3. Check pre-execution cancellation flag (Redis)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;4. Update status: queued → running&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;5. Append status event to job_events table&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;6. Start async heartbeat task&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;7. Execute handler (uses same adapters: Memgraph, LLM, Redis):&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp;- demo jobs: simple demonstration&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp;- test jobs: testing purposes&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp;- long-running jobs: extended analysis&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp;- agent.run jobs: async agent execution (orchestrator integration)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;• Load/Create AgentRun record → PostgreSQL&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;• Update AgentRun status: queued → running&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;• Emit SSE: agent_run_started&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;• Initialize Orchestrator.from_env()&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;• Emit SSE: orchestrator_init&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;• Execute orchestrator.run() with timeout&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;• LLM calls, MCP tools, Graph queries&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;• Persist steps per-step → PostgreSQL&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;• Session state → Redis&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;• Check cancellation between steps&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;• Emit progress events per orchestration step&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;• Apply PII scrubbing &amp;amp;amp; output guard&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;• Emit agent-specific Prometheus metrics&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;amp;nbsp; &amp;amp;nbsp; &amp;amp;nbsp;• Update AgentRun status → succeeded | failed&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;8. Periodically check cancellation flags (Redis: jobs:cancel:{id})&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;9. Emit progress events → RPUSH jobs:events:{id} → SSE to Control Panel&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;10. On completion: status = finished | failed | cancelled&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;11. Persist result → PostgreSQL&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;12. Append terminal event to job_events&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;Job Status State Machine: queued → running → finished | failed | cancelled&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;&amp;lt;br&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;Resources: 2 CPU, 4GB RAM&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;Uses same adapters/services as main app (shared codebase)&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;530\&quot; width=\&quot;550\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;jL9Ayfw5SwNCbvacDRDm-60\&quot; parent=\&quot;1\&quot; style=\&quot;swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#DAE4E6;strokeColor=default;\&quot; value=\&quot;&amp;lt;div style=&amp;quot;text-align: left;&amp;quot;&amp;gt;&amp;lt;div&amp;gt;&amp;lt;b style=&amp;quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&amp;quot;&amp;gt;PHASE 4)&amp;amp;nbsp;&amp;lt;/b&amp;gt;&amp;lt;b&amp;gt;Long-Running Job Completion&amp;lt;/b&amp;gt;&amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;120\&quot; width=\&quot;930\&quot; x=\&quot;610\&quot; y=\&quot;3045\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n        &lt;mxCell id=\&quot;jL9Ayfw5SwNCbvacDRDm-61\&quot; parent=\&quot;jL9Ayfw5SwNCbvacDRDm-60\&quot; style=\&quot;text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;\&quot; value=\&quot;&amp;lt;div&amp;gt;- State machine: queued → running → finished | failed | cancelled&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Persist job status → PostgreSQL&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Append progress/state events → job_events table&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Progress event format: {stage, message, percent}&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Stream updates via SSE to Control Panel (heartbeat keep-alive)&amp;lt;/div&amp;gt;&amp;lt;div&amp;gt;- Emit and persist terminal status: finished | failed | cancelled&amp;lt;/div&amp;gt;\&quot; vertex=\&quot;1\&quot;&gt;\n          &lt;mxGeometry height=\&quot;90\&quot; width=\&quot;930\&quot; y=\&quot;30\&quot; as=\&quot;geometry\&quot; /&gt;\n        &lt;/mxCell&gt;\n      &lt;/root&gt;\n    &lt;/mxGraphModel&gt;\n  &lt;/diagram&gt;\n&lt;/mxfile&gt;\n&quot;}"></div>
<script type="text/javascript" src="https://viewer.diagrams.net/js/viewer-static.min.js"></script>
</body>
</html>
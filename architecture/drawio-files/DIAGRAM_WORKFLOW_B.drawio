<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36" version="29.3.4">
  <diagram name="Page-1" id="o7U-nxtfvU7QnVVJ9hKv">
    <mxGraphModel grid="1" page="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" pageScale="1" pageWidth="850" pageHeight="1100" background="#ffffff" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-75" edge="1" parent="1" source="HJKx42f4Jz2vHTe7KREf-90" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeColor=default;" target="EiYPZZWAnG0CHaq9ObTb-10">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="HJKx42f4Jz2vHTe7KREf-90" parent="1" style="swimlane;whiteSpace=wrap;html=1;startSize=40;fillColor=#E0DDEF;strokeColor=default;" value="&lt;div&gt;IDENTITY &amp;amp; AUTHENTICATION LAYER:&amp;nbsp;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;CLIENTS &amp;amp; USER INTERFACES&lt;/span&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="550" width="570" x="-690" y="135" as="geometry">
            <mxRectangle height="30" width="140" x="470" y="210" as="alternateBounds" />
          </mxGeometry>
        </mxCell>
        <mxCell id="HJKx42f4Jz2vHTe7KREf-6" parent="HJKx42f4Jz2vHTe7KREf-90" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;fillColor=#F3F0FF;strokeColor=default;" value="&lt;div style=&quot;&quot;&gt;&lt;b&gt;Identity Provider (OIDC / Auth0)&lt;/b&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="160" width="550" x="10" y="50" as="geometry" />
        </mxCell>
        <mxCell id="HJKx42f4Jz2vHTe7KREf-7" parent="HJKx42f4Jz2vHTe7KREf-6" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" value="&lt;div&gt;- OAuth 2.0 login flow&lt;/div&gt;&lt;div&gt;- JWT tokens (tenant_id, sub, roles[], scopes[], exp, iat)&lt;/div&gt;&lt;div&gt;- JWKS endpoint for token verification&lt;/div&gt;&lt;div&gt;- Token refresh &amp;amp; revocation&lt;/div&gt;&lt;div&gt;- Principal:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;sub, tenant_id,&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;roles: [admin, operator, user, viewer],&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;scopes: [read, write, graph:read, ...]&lt;/div&gt;" vertex="1">
          <mxGeometry height="130" width="550" y="30" as="geometry" />
        </mxCell>
        <mxCell id="HJKx42f4Jz2vHTe7KREf-14" parent="HJKx42f4Jz2vHTe7KREf-90" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#F3F0FF;strokeColor=default;" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;div&gt;&lt;b&gt;Reverse Proxy / API Gateway (NGINX)&lt;/b&gt;&lt;/div&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="90" width="550" x="10" y="450" as="geometry" />
        </mxCell>
        <mxCell id="HJKx42f4Jz2vHTe7KREf-15" parent="HJKx42f4Jz2vHTe7KREf-14" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;-&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent;&quot;&gt;TLS termination (HTTPS)&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;- Routing to backend services&lt;/div&gt;&lt;div&gt;- CORS handling&lt;/div&gt;&lt;div&gt;-&amp;nbsp;Load balancing&amp;nbsp;&lt;/div&gt;" vertex="1">
          <mxGeometry height="60" width="550" y="30" as="geometry" />
        </mxCell>
        <mxCell id="jL9Ayfw5SwNCbvacDRDm-101" parent="HJKx42f4Jz2vHTe7KREf-90" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#F3F0FF;strokeColor=default;" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;div&gt;&lt;b&gt;Control Panel UI (Streamlit)&lt;/b&gt;&lt;/div&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="220" width="550" x="10" y="220" as="geometry" />
        </mxCell>
        <mxCell id="jL9Ayfw5SwNCbvacDRDm-102" parent="jL9Ayfw5SwNCbvacDRDm-101" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" value="&lt;div&gt;&lt;div&gt;[LONG-RUNNING JOBS -&amp;nbsp;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;WORKFLOW B&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;]&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;- Admin/Operator dashboard&lt;/div&gt;&lt;div&gt;- Jobs, models, tools management&lt;/div&gt;&lt;div&gt;- Graph/NL-&amp;gt;Cypher experiments&lt;/div&gt;&lt;div&gt;- SSE streaming for job events&lt;/div&gt;&lt;div&gt;- ETL, backup, maintenance triggers&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent;&quot;&gt;&lt;div style=&quot;&quot;&gt;POST /v1/jobs&lt;/div&gt;&lt;div style=&quot;&quot;&gt;- Bearer JWT, type, payload&lt;/div&gt;&lt;div style=&quot;&quot;&gt;- Job Types: demo, test, long-running, agent.run&lt;/div&gt;&lt;div style=&quot;&quot;&gt;- Returns: {id, status, created_at}&lt;/div&gt;&lt;/span&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="190" width="550" y="30" as="geometry" />
        </mxCell>
        <mxCell id="jL9Ayfw5SwNCbvacDRDm-104" edge="1" parent="1" source="EiYPZZWAnG0CHaq9ObTb-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=default;" target="jL9Ayfw5SwNCbvacDRDm-99">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-1" parent="1" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#D7E4D7;strokeColor=default;" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;div&gt;&lt;b&gt;API LAYER (Routers)&lt;/b&gt;&lt;/div&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="240" width="570" x="-690" y="725" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-2" parent="EiYPZZWAnG0CHaq9ObTb-1" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" value="&lt;div&gt;- /v1/health&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- Health probes (live, ready, startup, components)&lt;/div&gt;&lt;div&gt;- /v1/auth&amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- Token introspection, identity verification&lt;/div&gt;&lt;div&gt;- /v1/agents&amp;nbsp; &amp;nbsp; &amp;nbsp;- Agent definitions and configurations&lt;/div&gt;&lt;div&gt;- /v1/agent-runs - Agent run lifecycle (create, poll, cancel)&lt;/div&gt;&lt;div&gt;- /v1/tools&amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- MCP tool registry and invocation&lt;/div&gt;&lt;div&gt;- /v1/jobs&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- Async job lifecycle (create, stream, cancel)&lt;/div&gt;&lt;div&gt;- /v1/models&amp;nbsp; &amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- Model and provider management&lt;/div&gt;&lt;div&gt;- /v1/admin&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- Administrative operations&lt;/div&gt;&lt;div&gt;- /v1/tenants&amp;nbsp; &amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- Multi-tenant configuration&lt;/div&gt;&lt;div&gt;- /v1/sessions&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- Session management&lt;/div&gt;&lt;div&gt;- /v1/graph&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- Graph query endpoints&lt;/div&gt;&lt;div&gt;- /v1/batch&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- Batch operations&lt;/div&gt;&lt;div&gt;- /v1/export&amp;nbsp; &amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- Data export utilities&lt;/div&gt;&lt;div&gt;- /v1/internal&amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- Internal diagnostics&lt;/div&gt;" vertex="1">
          <mxGeometry height="210" width="570" y="30" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-81" edge="1" parent="1" source="EiYPZZWAnG0CHaq9ObTb-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeColor=default;" target="EiYPZZWAnG0CHaq9ObTb-29">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-5" parent="1" style="swimlane;whiteSpace=wrap;html=1;fillColor=#EBDFBC;strokeColor=default;" value="&lt;div&gt;SERVICE LAYER&lt;/div&gt;" vertex="1">
          <mxGeometry height="700" width="570" x="-40" y="1235" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-6" parent="EiYPZZWAnG0CHaq9ObTb-5" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#FFF2CC;strokeColor=default;" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;b&gt;ORCHESTRATOR&amp;nbsp;&lt;/b&gt;&lt;b&gt;SERVICE&lt;/b&gt;&lt;b&gt;: 1 Run per prompt,&amp;nbsp;&lt;/b&gt;&lt;span style=&quot;background-color: transparent; text-align: center;&quot;&gt;&lt;b&gt;4 Phases&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="500" width="550" x="10" y="40" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-7" parent="EiYPZZWAnG0CHaq9ObTb-6" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" value="&lt;div&gt;&lt;b&gt;PHASE 1) INTENT CLASSIFICATION:&lt;/b&gt;&lt;/div&gt;&lt;div&gt;- A&lt;span style=&quot;background-color: transparent;&quot;&gt;nalyzes prompt via LLM&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;background-color: transparent;&quot;&gt;- Check params.category → Match prompt catalog → Apply classify_intent()&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&amp;nbsp; - CHAT - Conversational responses&lt;/div&gt;&lt;div&gt;&amp;nbsp; - GRAPH - Analytics, NL-&amp;gt;Cypher queries&lt;/div&gt;&lt;div&gt;&amp;nbsp; - SECURITY - Security/permissions questions&lt;/div&gt;&lt;div&gt;&amp;nbsp; - ADMIN - Administrative write operations&lt;/div&gt;&lt;div&gt;&amp;nbsp; - DANGEROUS - Destructive ops → refuse + offer EXPLAIN&lt;/div&gt;&lt;div&gt;&amp;nbsp; - EXPLAIN - EXPLAIN-only query analysis&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent;&quot;&gt;&lt;b&gt;PHASE 2) TODO Planning&lt;/b&gt;&lt;/span&gt;&lt;b&gt;&amp;nbsp;(multi-step run):&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;div style=&quot;&quot;&gt;- LLM-based planning&lt;/div&gt;&lt;div style=&quot;&quot;&gt;- Input: Goal + Context + Schema → Output: TODO Array&lt;/div&gt;&lt;div style=&quot;&quot;&gt;- Planning Modes: full (LLM per TODO) | optional (try direct) | none (deterministic)&lt;/div&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;b&gt;PHASE 3) Step Execution,&amp;nbsp;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;FOR EACH TODO&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;:&lt;/span&gt;&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; 1. Call LLM Provider (planner, reflector, responder)&lt;/div&gt;&lt;div&gt;&amp;nbsp; 2. Invoke MCP Tools with RBAC check (34 tools available)&lt;/div&gt;&lt;div&gt;&amp;nbsp; 3. If GRAPH mode: NL-&amp;gt;Cypher pipeline&lt;/div&gt;&lt;div&gt;&amp;nbsp; 4. Persist step → PostgreSQL&amp;nbsp;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;(via adaptor)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; 5. Use Redis for session/cache/cancel&amp;nbsp;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;(via adaptor)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;- Step records: {id, action, input, output, latency_ms, started_at, finished_at}&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;b&gt;PHASE 4)&amp;nbsp;&lt;/b&gt;&lt;b style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;Finalization &amp;amp;&amp;nbsp;&lt;/b&gt;&lt;b style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;Response Generation&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;- build_response() → Orchestration Result&lt;/div&gt;&lt;div&gt;- Response mode selection: fallback-only | llm-best-effort&lt;/div&gt;&lt;div&gt;- Canonical output structure: {goal, steps[], outputs[], todos[], metrics}&lt;/div&gt;&lt;div&gt;- Normalize final output: text + optional JSON payload&lt;/div&gt;&lt;div&gt;- Safety/compliance: PII scrubbing + output guard checks&lt;/div&gt;&lt;div&gt;- Persist final state + metrics → PostgreSQL&lt;/div&gt;&lt;div&gt;- Observability: emit Prometheus metrics + OpenTelemetry traces&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="470" width="550" y="30" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-8" parent="EiYPZZWAnG0CHaq9ObTb-5" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#FFF2CC;strokeColor=default;" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;b&gt;ADDITIONAL SERVICES&lt;/b&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="120" width="550" x="10" y="560" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-9" parent="EiYPZZWAnG0CHaq9ObTb-8" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;- Session Service (state management)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;- Job Service (job lifecycle)&lt;/div&gt;&lt;div&gt;- Default Model Resolver&lt;/div&gt;&lt;div&gt;- Health / ETL / Archive Services&lt;/div&gt;&lt;div&gt;- Invocation Store (audit trail)&lt;/div&gt;" vertex="1">
          <mxGeometry height="90" width="550" y="30" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-77" edge="1" parent="1" source="EiYPZZWAnG0CHaq9ObTb-10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.75;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;strokeColor=default;" target="EiYPZZWAnG0CHaq9ObTb-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-10" parent="1" style="swimlane;whiteSpace=wrap;html=1;fillColor=#EAD6D6;strokeColor=default;rounded=0;absoluteArcSize=0;swimlaneFillColor=none;fillStyle=solid;" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;b&gt;SECURITY&amp;nbsp;&lt;/b&gt;&lt;span style=&quot;background-color: transparent; text-align: center;&quot;&gt;MIDDLEWARE STACK&lt;/span&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="1050" width="930" x="-40" y="135" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-11" parent="EiYPZZWAnG0CHaq9ObTb-10" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;fillColor=#FFE9E9;strokeColor=default;" value="&lt;div style=&quot;&quot;&gt;&lt;div&gt;&lt;b&gt;1. CORS Handler - Cross-Origin Resource Sharing policy enforcement&lt;/b&gt;&lt;/div&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="90" width="910" x="10" y="40" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-12" parent="EiYPZZWAnG0CHaq9ObTb-11" style="text;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;strokeColor=default;" value="&lt;div&gt;- Allowed origins, methods, headers configuration&lt;/div&gt;&lt;div&gt;- Preflight OPTIONS request handling&lt;/div&gt;&lt;div&gt;- Credentials and expose headers support&lt;/div&gt;" vertex="1">
          <mxGeometry height="60" width="910" y="30" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-13" parent="EiYPZZWAnG0CHaq9ObTb-10" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;fillColor=#FFE9E9;strokeColor=default;" value="&lt;div style=&quot;&quot;&gt;&lt;div&gt;&lt;b&gt;2. Trace Context - OpenTelemetry distributed tracing context&lt;/b&gt;&lt;/div&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="90" width="910" x="10" y="140" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-14" parent="EiYPZZWAnG0CHaq9ObTb-13" style="text;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;strokeColor=default;" value="&lt;div&gt;- Injects/extracts W3C trace-context headers (traceparent, tracestate)&lt;/div&gt;&lt;div&gt;- Creates root span if missing, propagates existing trace&lt;/div&gt;&lt;div&gt;- Adds trace_id, span_id, parent_id to request context&lt;/div&gt;" vertex="1">
          <mxGeometry height="60" width="910" y="30" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-15" parent="EiYPZZWAnG0CHaq9ObTb-10" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;fillColor=#FFE9E9;strokeColor=default;" value="&lt;div style=&quot;&quot;&gt;&lt;div&gt;&lt;b&gt;3. Auth JWT - JWT/OIDC token validation and principal extraction&lt;/b&gt;&lt;/div&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="110" width="910" x="10" y="240" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-16" parent="EiYPZZWAnG0CHaq9ObTb-15" style="text;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;strokeColor=default;" value="&lt;div&gt;- Validates Bearer token via JWKS endpoint (RS256/RS384/RS512)&lt;/div&gt;&lt;div&gt;- Extracts claims: sub, tenant_id, roles[], scopes[], exp, iat&lt;/div&gt;&lt;div&gt;&lt;div&gt;- RBAC &amp;amp; Scope Enforcement for endpoints&lt;/div&gt;&lt;/div&gt;&lt;div&gt;- Builds Principal object for downstream authorization&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;- Rejects expired/invalid/malformed tokens with 401 Unauthorized&lt;/div&gt;" vertex="1">
          <mxGeometry height="80" width="910" y="30" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-17" parent="EiYPZZWAnG0CHaq9ObTb-10" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;fillColor=#FFE9E9;strokeColor=default;" value="&lt;div style=&quot;&quot;&gt;&lt;div&gt;&lt;b&gt;4. Rate Limit - Redis-backed rate limiting with multiple dimensions&lt;/b&gt;&lt;/div&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="110" width="910" x="10" y="470" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-18" parent="EiYPZZWAnG0CHaq9ObTb-17" style="text;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;strokeColor=default;" value="&lt;div&gt;- Per-user limits: ratelimit:user:{sub}&lt;/div&gt;&lt;div&gt;- Per-tenant limits: ratelimit:tenant:{tenant_id}&lt;/div&gt;&lt;div&gt;- Per-endpoint limits: ratelimit:endpoint:{method}:{path}&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;- Sliding window algorithm, returns 429 Too Many Requests when exceeded&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;- X-RateLimit-Limit, X-RateLimit-Remaining, X-RateLimit-Reset headers&lt;/div&gt;" vertex="1">
          <mxGeometry height="80" width="910" y="30" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-19" parent="EiYPZZWAnG0CHaq9ObTb-10" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;fillColor=#FFE9E9;strokeColor=default;" value="&lt;div style=&quot;&quot;&gt;&lt;div&gt;&lt;b&gt;5. Tenant Resolver - Multi-tenancy isolation and context resolution&lt;/b&gt;&lt;/div&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="100" width="910" x="10" y="600" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-20" parent="EiYPZZWAnG0CHaq9ObTb-19" style="text;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;strokeColor=default;" value="&lt;div&gt;- Resolves tenant configuration from Redis cache or PostgreSQL&lt;/div&gt;&lt;div&gt;- Injects tenant_id filter into all database queries&lt;/div&gt;&lt;div&gt;- Enforces data isolation between tenants&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;- Loads tenant-specific settings (model defaults, feature flags)&lt;/div&gt;" vertex="1">
          <mxGeometry height="70" width="910" y="30" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-21" parent="EiYPZZWAnG0CHaq9ObTb-10" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;fillColor=#FFE9E9;strokeColor=default;" value="&lt;div style=&quot;&quot;&gt;&lt;div&gt;&lt;b&gt;6. Input Guard - Request payload validation and sanitization&lt;/b&gt;&lt;/div&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="100" width="910" x="10" y="710" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-22" parent="EiYPZZWAnG0CHaq9ObTb-21" style="text;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;strokeColor=default;" value="&lt;div&gt;- Pydantic schema validation for all request bodies&lt;/div&gt;&lt;div&gt;- Injection prevention (SQL, Cypher, command injection patterns)&lt;/div&gt;&lt;div&gt;- Content-type validation and size limits&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;- Malicious payload detection&lt;/div&gt;" vertex="1">
          <mxGeometry height="70" width="910" y="30" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-23" parent="EiYPZZWAnG0CHaq9ObTb-10" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;fillColor=#FFE9E9;strokeColor=default;" value="&lt;div style=&quot;&quot;&gt;&lt;b&gt;7. Output Guard - Response sanitization and compliance&lt;/b&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="100" width="910" x="10" y="820" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-24" parent="EiYPZZWAnG0CHaq9ObTb-23" style="text;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;strokeColor=default;" value="&lt;div&gt;- PII scrubbing (email redaction, phone masking, SSN removal)&lt;/div&gt;&lt;div&gt;- Content filtering for sensitive data patterns&lt;/div&gt;&lt;div&gt;- Response size validation and truncation&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;- Audit logging of all responses with correlation IDs&lt;/div&gt;" vertex="1">
          <mxGeometry height="70" width="910" y="30" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-25" parent="EiYPZZWAnG0CHaq9ObTb-10" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;fillColor=#FFE9E9;strokeColor=default;" value="&lt;div style=&quot;&quot;&gt;&lt;div&gt;&lt;b&gt;8. Error Handler - Centralized exception handling and error response formatting&lt;/b&gt;&lt;/div&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="100" width="910" x="10" y="930" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-26" parent="EiYPZZWAnG0CHaq9ObTb-25" style="text;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;strokeColor=default;" value="&lt;div&gt;- PII scrubbing (email redaction, phone masking, SSN removal)&lt;/div&gt;&lt;div&gt;- Content filtering for sensitive data patterns&lt;/div&gt;&lt;div&gt;- Response size validation and truncation&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;- Audit logging of all responses with correlation IDs&lt;/div&gt;" vertex="1">
          <mxGeometry height="70" width="910" y="30" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-27" parent="EiYPZZWAnG0CHaq9ObTb-10" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#FFE9E9;strokeColor=default;" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;div&gt;&lt;b&gt;RBAC PERMISSION MATRIX&lt;/b&gt;&lt;/div&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="100" width="910" x="10" y="360" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-28" parent="EiYPZZWAnG0CHaq9ObTb-27" style="text;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;strokeColor=default;" value="&lt;div&gt;- admin:&amp;nbsp; &amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;agent-runs=CRUD,&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;jobs=CRUD,&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;tools=CRUD,&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;tenants=CRUD,&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;graph(write)=✓&lt;/div&gt;&lt;div&gt;- operator: &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;agent-runs=CRU,&amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;jobs=CRUD, &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;tools=R,&amp;nbsp; &amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;tenants=R,&amp;nbsp; &amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;graph(write)=✗&lt;/div&gt;&lt;div&gt;- user:&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;agent-runs=CR,&amp;nbsp; &amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;jobs=CRD,&amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;tools=R,&amp;nbsp; &amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;tenants=✗,&amp;nbsp; &amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;graph(write)=✗&lt;/div&gt;&lt;div&gt;- viewer:&amp;nbsp; &amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;agent-runs=R,&amp;nbsp; &amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;jobs=R,&amp;nbsp; &amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;tools=R,&amp;nbsp; &amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;tenants=✗,&amp;nbsp; &amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;graph(write)=✗&lt;/div&gt;" vertex="1">
          <mxGeometry height="70" width="910" y="30" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-82" edge="1" parent="1" source="EiYPZZWAnG0CHaq9ObTb-29" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=default;" target="EiYPZZWAnG0CHaq9ObTb-43">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-29" parent="1" style="swimlane;whiteSpace=wrap;html=1;fillColor=#EBDED4;strokeColor=default;" value="&lt;b style=&quot;text-align: left;&quot;&gt;PHASE 3: Step Execution,&amp;nbsp;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;FOR EACH TODO&lt;/span&gt;&lt;/b&gt;" vertex="1">
          <mxGeometry height="855" width="930" x="610" y="1235" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-30" parent="EiYPZZWAnG0CHaq9ObTb-29" style="swimlane;whiteSpace=wrap;html=1;fillColor=#FFF1E6;strokeColor=default;" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;span style=&quot;background-color: transparent;&quot;&gt;Step 1) LLM PROVIDERS&lt;/span&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="230" width="910" x="10" y="45" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-31" parent="EiYPZZWAnG0CHaq9ObTb-30" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#FFF1E6;strokeColor=default;" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;div&gt;&lt;b&gt;OpenAI&lt;/b&gt;&lt;/div&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="80" width="430" x="10" y="140" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-32" parent="EiYPZZWAnG0CHaq9ObTb-31" style="text;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;strokeColor=default;" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;- Cloud LLM API&lt;/span&gt;&lt;/div&gt;&lt;div&gt;- GPT-4, GPT-3.5, etc.&lt;/div&gt;" vertex="1">
          <mxGeometry height="50" width="430" y="30" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-33" parent="EiYPZZWAnG0CHaq9ObTb-30" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#FFF1E6;strokeColor=default;" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;div&gt;&lt;b&gt;Ollama (Local)&lt;/b&gt;&lt;/div&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="90" width="890" x="10" y="40" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-34" parent="EiYPZZWAnG0CHaq9ObTb-33" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" value="&lt;div&gt;&lt;div&gt;- Local LLM hosting&lt;/div&gt;&lt;div&gt;- Self-hosted models:&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;(phi3:mini,&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;Mistral,&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;LLaMA,&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;Qwen,&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;Gemma)&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="60" width="890" y="30" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-35" parent="EiYPZZWAnG0CHaq9ObTb-30" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;fillColor=#FFF1E6;strokeColor=default;" value="&lt;div style=&quot;&quot;&gt;&lt;b&gt;Azure OpenAI / Other Providers&lt;/b&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="80" width="450" x="450" y="140" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-36" parent="EiYPZZWAnG0CHaq9ObTb-35" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;- Compatible OpenAI-style APIs&lt;/span&gt;&lt;/div&gt;&lt;div&gt;- Enterprise deployments&lt;/div&gt;" vertex="1">
          <mxGeometry height="50" width="450" y="30" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-37" parent="EiYPZZWAnG0CHaq9ObTb-29" style="swimlane;fontStyle=1;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#FFF1E6;strokeColor=default;" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;div&gt;Step 2) MCP RUNTIME &amp;amp; TOOLS (34 Tools, 12 Categories)&lt;/div&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="370" width="910" x="10" y="290" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-38" parent="EiYPZZWAnG0CHaq9ObTb-37" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" value="&lt;div&gt;&lt;div&gt;- Tool Registry (PostgreSQL-backed manifests)&lt;/div&gt;&lt;div&gt;- Tool Policies (RBAC per tool, required_scopes)&lt;/div&gt;&lt;div&gt;- MCP Runtime (ToolContext, audit logging)&lt;/div&gt;&lt;div&gt;- Tool Invocation:&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;Request → Schema Validation → RBAC Check → Execute → Audit Log&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;b&gt;Tool Categories:&lt;/b&gt;&lt;/div&gt;&lt;div&gt;- GRAPH&amp;nbsp; &amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- query, secure_query, generate_cypher, schema, explain&lt;/div&gt;&lt;div&gt;- SECURITY &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- describe_principal, allowed_operations, validate&lt;/div&gt;&lt;div&gt;- SYSTEM&amp;nbsp; &amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- health, metrics, config, status&lt;/div&gt;&lt;div&gt;- CACHE&amp;nbsp; &amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- get, set, delete, invalidate&lt;/div&gt;&lt;div&gt;- CATALOG&amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- discover, describe, search&lt;/div&gt;&lt;div&gt;- MODEL&amp;nbsp; &amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- list, info, warmup, switch&lt;/div&gt;&lt;div&gt;- AGENT&amp;nbsp; &amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- context, history, state&lt;/div&gt;&lt;div&gt;- ANALYTICS &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- query, aggregate, visualize&lt;/div&gt;&lt;div&gt;- ADMIN&amp;nbsp; &amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- create_index, drop_index, constraint&lt;/div&gt;&lt;div&gt;- ETL&amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;- import, export, transform&lt;/div&gt;&lt;div&gt;- CRUD&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- create_node, update_node, delete_node&lt;/div&gt;&lt;div&gt;- EXPORT&amp;nbsp; &amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- csv, json, cypher&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;Tool Manifest (from PostgreSQL):&lt;/div&gt;&lt;div&gt;{name, description, input_schema, required_scopes,&amp;nbsp;&lt;/div&gt;&lt;div&gt;rate_limit: {requests: 100, window: 60}}&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="340" width="910" y="30" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-39" parent="EiYPZZWAnG0CHaq9ObTb-29" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;fillColor=#FFF1E6;strokeColor=default;" value="&lt;div style=&quot;&quot;&gt;&lt;div&gt;&lt;b&gt;Step 3) NL&amp;nbsp;&lt;span style=&quot;text-align: left;&quot;&gt;→&lt;/span&gt;&amp;nbsp;CYPHER PIPELINE&lt;/b&gt;&lt;/div&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="160" width="910" x="10" y="675" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-40" parent="EiYPZZWAnG0CHaq9ObTb-39" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" value="&lt;div&gt;&lt;span style=&quot;text-align: center;&quot;&gt;[In case of GRAPH mode]&lt;/span&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;text-align: center;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;1. Normalize NL prompt → standardize user question&lt;/div&gt;&lt;div&gt;2. Generate Cypher → LLM-based or test hints&lt;/div&gt;&lt;div&gt;3. Validate Safety → read-only enforcement, tenant boundaries, injection prevention&lt;/div&gt;&lt;div&gt;4. Execute on Memgraph → run validated Cypher query&lt;/div&gt;&lt;div&gt;5. Summarize Results → convert graph results to natural language&lt;/div&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="130" width="910" y="30" as="geometry" />
        </mxCell>
        <mxCell id="jL9Ayfw5SwNCbvacDRDm-103" edge="1" parent="1" source="EiYPZZWAnG0CHaq9ObTb-43" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=default;" target="jL9Ayfw5SwNCbvacDRDm-60">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-43" parent="1" style="swimlane;whiteSpace=wrap;html=1;fillColor=light-dark(#D7ECE9,#EDEDED);strokeColor=default;" value="&lt;b style=&quot;text-align: left;&quot;&gt;Step 4 &amp;amp; 5)&lt;/b&gt;" vertex="1">
          <mxGeometry height="850" width="930" x="610" y="2145" as="geometry">
            <mxRectangle height="30" width="100" x="540" y="2570" as="alternateBounds" />
          </mxGeometry>
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-44" parent="EiYPZZWAnG0CHaq9ObTb-43" style="swimlane;whiteSpace=wrap;html=1;strokeColor=default;fillColor=#EAFFFB;" value="ADAPTERS &amp;amp; RESILIENCE FRAMEWORK" vertex="1">
          <mxGeometry height="320" width="910" x="10" y="40" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-45" parent="EiYPZZWAnG0CHaq9ObTb-44" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;strokeColor=default;fillColor=#EAFFFB;" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;b&gt;LLM Adapters&lt;/b&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="110" width="333.75" x="16.25" y="40" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-46" parent="EiYPZZWAnG0CHaq9ObTb-45" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;- Ollama adapter (local LLMs)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;- OpenAI-style API adapter&lt;/span&gt;&lt;/div&gt;&lt;div&gt;- Stub/Demo adapter (testing)&lt;/div&gt;&lt;div&gt;- Azure OpenAI adapter&lt;/div&gt;" vertex="1">
          <mxGeometry height="80" width="333.75" y="30" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-47" parent="EiYPZZWAnG0CHaq9ObTb-44" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;strokeColor=default;fillColor=#EAFFFB;" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;b&gt;Resilience Mechanisms&lt;/b&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="110" width="540" x="360" y="40" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-48" parent="EiYPZZWAnG0CHaq9ObTb-47" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" value="&lt;div&gt;- Circuit Breaker States per provider:&amp;nbsp;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;CLOSED (normal) → OPEN (reject) → HALF_OPEN (test one) → CLOSED&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;- Automatic Retries with exponential backoff&lt;/span&gt;&lt;/div&gt;&lt;div&gt;- Cost Tracking per provider/model&lt;/div&gt;&lt;div&gt;- Provider Fallback chain&lt;/div&gt;" vertex="1">
          <mxGeometry height="80" width="540" y="30" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-49" parent="EiYPZZWAnG0CHaq9ObTb-44" style="swimlane;whiteSpace=wrap;html=1;strokeColor=default;fillColor=#EAFFFB;" value="Database Adapters" vertex="1">
          <mxGeometry height="150" width="883.75" x="16.25" y="160" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-50" parent="EiYPZZWAnG0CHaq9ObTb-49" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;strokeColor=default;fillColor=#EAFFFB;" value="&lt;div style=&quot;&quot;&gt;&lt;div&gt;&lt;b&gt;Redis Adapter&lt;/b&gt;&lt;/div&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="100" width="80" x="93.75" y="40" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-51" parent="EiYPZZWAnG0CHaq9ObTb-50" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;- cache&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;- queues&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;- rate limits&lt;/span&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="70" width="80" y="30" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-52" parent="EiYPZZWAnG0CHaq9ObTb-49" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;strokeColor=default;fillColor=#EAFFFB;" value="&lt;div style=&quot;&quot;&gt;&lt;b&gt;PostgreSQL Adapter&lt;/b&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="100" width="90" x="403.75" y="40" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-53" parent="EiYPZZWAnG0CHaq9ObTb-52" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" value="&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;- repositories&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;- transactions&lt;/span&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="70" width="90" y="30" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-54" parent="EiYPZZWAnG0CHaq9ObTb-49" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;align=center;strokeColor=default;fillColor=#EAFFFB;" value="&lt;div style=&quot;&quot;&gt;&lt;div&gt;&lt;b&gt;Memgraph Adapter&lt;/b&gt;&lt;/div&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="100" width="100" x="693.75" y="40" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-55" parent="EiYPZZWAnG0CHaq9ObTb-54" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" value="&lt;div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;- graph queries&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;- NL-&amp;gt;Cypher&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="70" width="100" y="30" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-56" parent="EiYPZZWAnG0CHaq9ObTb-43" style="swimlane;whiteSpace=wrap;html=1;strokeColor=default;fillColor=#EADFE9;" value="DATA &amp;amp; INFRASTRUCTURE LAYER" vertex="1">
          <mxGeometry height="460" width="910" x="10" y="380" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-57" parent="EiYPZZWAnG0CHaq9ObTb-56" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;strokeColor=default;fillColor=#EADFE9;" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;b&gt;PostgreSQL&lt;/b&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="240" width="280" x="330" y="40" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-58" parent="EiYPZZWAnG0CHaq9ObTb-57" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" value="&lt;div&gt;&lt;div&gt;&lt;b&gt;Tables:&lt;/b&gt;&lt;/div&gt;&lt;div&gt;- tenants&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- Multi-tenant configurations&lt;/div&gt;&lt;div&gt;- agent_runs&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- Agent run records with status&lt;/div&gt;&lt;div&gt;- steps&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- Per-step execution records&lt;/div&gt;&lt;div&gt;- sessions&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- User session state&lt;/div&gt;&lt;div&gt;- jobs&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;- Async job records&lt;/div&gt;&lt;div&gt;- job_events&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- Job progress events&lt;/div&gt;&lt;div&gt;- tool_manifests&amp;nbsp; &amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- MCP tool definitions&lt;/div&gt;&lt;div&gt;- model_defaults&amp;nbsp; &amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- Default model configurations&lt;/div&gt;&lt;div&gt;- audit_logs&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- All action audit trail&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;SQLAlchemy + Alembic migrations&lt;/div&gt;&lt;div&gt;Used by: App (Background Tasks)&amp;nbsp;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;+ Workers&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="210" width="280" y="30" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-59" parent="EiYPZZWAnG0CHaq9ObTb-56" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;strokeColor=default;fillColor=#EADFE9;" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;div&gt;&lt;b&gt;Memgraph (Graph Database)&lt;/b&gt;&lt;/div&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="410" width="280" x="620" y="40" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-60" parent="EiYPZZWAnG0CHaq9ObTb-59" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;b&gt;Nodes:&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;- (:User&amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;{id, name, email})&lt;/div&gt;&lt;div&gt;- (:Task &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;{id, title, status})&lt;/div&gt;&lt;div&gt;- (:File &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;{id, name, path})&lt;/div&gt;&lt;div&gt;- (:Institution &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;{id, name})&lt;/div&gt;&lt;div&gt;- (:Project &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;{id, name})&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;Relationships:&lt;/b&gt;&lt;/div&gt;&lt;div&gt;- (User)-[:ASSIGNED_TO]-&amp;gt;(Task)&lt;/div&gt;&lt;div&gt;- (User)-[:OWNS]-&amp;gt;(File)&lt;/div&gt;&lt;div&gt;- (User)-[:BELONGS_TO]-&amp;gt;(Institution)&lt;/div&gt;&lt;div&gt;- (Task)-[:PART_OF]-&amp;gt;(Project)&lt;/div&gt;&lt;div&gt;- (File)-[:ATTACHED_TO]-&amp;gt;(Task)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;NL-&amp;gt;Cypher Pipeline Components:&lt;/b&gt;&lt;/div&gt;&lt;div&gt;- NL normalization (standardize user question)&lt;/div&gt;&lt;div&gt;- Cypher generation (LLM-based or test hints)&lt;/div&gt;&lt;div&gt;- Safety validation (read-only, tenant boundaries, injection prevention)&lt;/div&gt;&lt;div&gt;- Query execution (run validated Cypher)&lt;/div&gt;&lt;div&gt;- Result summarization (convert to natural language)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Used by: NL-&amp;gt;Cypher, graph.* tools, analytics,&amp;nbsp;ETL jobs&lt;/div&gt;" vertex="1">
          <mxGeometry height="380" width="280" y="30" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-61" parent="EiYPZZWAnG0CHaq9ObTb-56" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;strokeColor=default;fillColor=#EADFE9;" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;b&gt;Redis (Cache &amp;amp; Queues)&lt;/b&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="330" width="310" x="10" y="40" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-62" parent="EiYPZZWAnG0CHaq9ObTb-61" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;b&gt;CACHE:&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;- session:{id}&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;- Session data&lt;/div&gt;&lt;div&gt;- tenant:config:{id}&amp;nbsp; &amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- Tenant configurations&lt;/div&gt;&lt;div&gt;- model:defaults:{id} &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- Model defaults&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;b&gt;QUEUES:&lt;/b&gt;&lt;/div&gt;&lt;div&gt;- jobs:queue:{type}&amp;nbsp; &amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- Job queue (LPUSH/BRPOP)&lt;/div&gt;&lt;div&gt;- jobs:events:{id}&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- SSE event buffer (ring)&lt;/div&gt;&lt;div&gt;- jobs:state:{id}&amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- Job state (HASH)&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;RATE LIMITING:&lt;/b&gt;&lt;/div&gt;&lt;div&gt;- ratelimit:user:{id}&amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- Per-user limits&lt;/div&gt;&lt;div&gt;- ratelimit:tenant:{id}&amp;nbsp; &amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- Per-tenant limits&lt;/div&gt;&lt;div&gt;- ratelimit:endpoint:{}&amp;nbsp; &amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- Per-endpoint limits&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;b&gt;CONTROL:&lt;/b&gt;&lt;/div&gt;&lt;div&gt;- idempotency:{key}&amp;nbsp; &amp;nbsp; &lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;- Idempotency mapping&lt;/div&gt;&lt;div&gt;- circuit:{provider}&amp;nbsp; &amp;nbsp;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;span style=&quot;white-space: pre;&quot;&gt;&#x9;&lt;/span&gt;&lt;/span&gt;- Circuit breaker state&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Used by: App (Background Tasks) + Workers&lt;/div&gt;" vertex="1">
          <mxGeometry height="300" width="310" y="30" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-85" parent="1" style="swimlane;whiteSpace=wrap;html=1;fillColor=#E0E0E0;fontColor=#333333;strokeColor=default;" value="&lt;b style=&quot;text-align: left;&quot;&gt;BACKGROUND FRAMEWORK&lt;/b&gt;" vertex="1">
          <mxGeometry height="900" width="570" x="-40" y="1965" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-72" parent="EiYPZZWAnG0CHaq9ObTb-85" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#F3F3F3;fontColor=#333333;strokeColor=default;" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;div&gt;&lt;b&gt;APScheduler&lt;/b&gt;&lt;/div&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="110" width="550" x="10" y="40" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-73" parent="EiYPZZWAnG0CHaq9ObTb-72" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" value="&lt;div&gt;Scheduled Tasks&lt;/div&gt;&lt;div&gt;- Health check (30s): Postgres ping, Redis ping, Memgraph ping, LLM warmup/availability&lt;/div&gt;&lt;div&gt;- Cleanup (hourly): stale/old sessions, expired/stale cache, expired jobs, old job records, orphan runs&lt;/div&gt;&lt;div&gt;- Backup (daily): PostgreSQL dump, Redis RDB snapshot, Memgraph archives, audit logs export&lt;/div&gt;&lt;div&gt;- Provider monitoring: provider health + metrics emission&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="80" width="550" y="30" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-63" parent="EiYPZZWAnG0CHaq9ObTb-85" style="swimlane;whiteSpace=wrap;html=1;fillColor=#E0E0E0;fontColor=#333333;strokeColor=default;" value="&lt;b style=&quot;text-align: left;&quot;&gt;OBSERVABILITY &amp;amp; MONITORING&lt;/b&gt;" vertex="1">
          <mxGeometry height="730" width="550" x="10" y="160" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-64" parent="EiYPZZWAnG0CHaq9ObTb-63" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#F3F3F3;fontColor=#333333;strokeColor=default;" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;b&gt;Prometheus (Metrics Collection)&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="190" width="530" x="10" y="530" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-65" parent="EiYPZZWAnG0CHaq9ObTb-64" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;- Scrapes /metrics from: app &amp;amp; workers&lt;/span&gt;&lt;/div&gt;&lt;div&gt;- Metrics collected:&lt;/div&gt;&lt;div&gt;&amp;nbsp; - HTTP request latency &amp;amp; throughput&lt;/div&gt;&lt;div&gt;&amp;nbsp; - Agent run / step execution metrics&lt;/div&gt;&lt;div&gt;&amp;nbsp; - Tool invocation metrics&lt;/div&gt;&lt;div&gt;&amp;nbsp; - LLM token usage &amp;amp; cost&lt;/div&gt;&lt;div&gt;&amp;nbsp; - LLM provider health / circuit breaker states&lt;/div&gt;&lt;div&gt;&amp;nbsp; - Job processing metrics&lt;/div&gt;&lt;div&gt;&amp;nbsp; - Job queue depths&lt;/div&gt;&lt;div&gt;&amp;nbsp; - System health status&lt;/div&gt;" vertex="1">
          <mxGeometry height="160" width="530" y="30" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-66" parent="EiYPZZWAnG0CHaq9ObTb-63" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#F3F3F3;fontColor=#333333;strokeColor=default;" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;b&gt;Grafana (Dashboards)&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="140" width="530" x="10" y="380" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-67" parent="EiYPZZWAnG0CHaq9ObTb-66" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;- Dashboards for:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; - HTTP request metrics&lt;/div&gt;&lt;div&gt;&amp;nbsp; - Agent run statistics (runs/steps)&lt;/div&gt;&lt;div&gt;&amp;nbsp; - Job processing &amp;amp; queue metrics&lt;/div&gt;&lt;div&gt;&amp;nbsp; - Tool invocation stats&lt;/div&gt;&lt;div&gt;&amp;nbsp; - LLM provider health &amp;amp; circuit breaker states&lt;/div&gt;&lt;div&gt;&amp;nbsp; - System / component health status&lt;/div&gt;" vertex="1">
          <mxGeometry height="110" width="530" y="30" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-68" parent="EiYPZZWAnG0CHaq9ObTb-63" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#F3F3F3;fontColor=#333333;strokeColor=default;" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;b&gt;Instrumentation &amp;amp; Endpoints&lt;/b&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="150" width="530" x="10" y="40" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-69" parent="EiYPZZWAnG0CHaq9ObTb-68" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;- Prometheus /metrics endpoint (exposed by app &amp;amp; workers)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;- OpenTelemetry tracing (OTLP export from app &amp;amp; workers)&lt;/div&gt;&lt;div&gt;- Structured logging (JSON format)&lt;/div&gt;&lt;div&gt;- Health endpoints:&lt;/div&gt;&lt;div&gt;&amp;nbsp; - /v1/health/live&lt;/div&gt;&lt;div&gt;&amp;nbsp; - /v1/health/ready&lt;/div&gt;&lt;div&gt;&amp;nbsp; - /v1/health/startup&lt;/div&gt;&lt;div&gt;&amp;nbsp; - /v1/health/components&lt;/div&gt;" vertex="1">
          <mxGeometry height="120" width="530" y="30" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-70" parent="EiYPZZWAnG0CHaq9ObTb-63" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#F3F3F3;fontColor=#333333;strokeColor=default;" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;&lt;b&gt;Tracing (OTel Collector + APM Backend)&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="170" width="530" x="10" y="200" as="geometry" />
        </mxCell>
        <mxCell id="EiYPZZWAnG0CHaq9ObTb-71" parent="EiYPZZWAnG0CHaq9ObTb-70" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;- OTel Collector / APM:&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&amp;nbsp; - Receives OTLP traces from: app &amp;amp; workers&lt;/div&gt;&lt;div&gt;&amp;nbsp; - Exports to: Jaeger / Tempo / APM backend&lt;/div&gt;&lt;div&gt;- Trace spans include:&lt;/div&gt;&lt;div&gt;&amp;nbsp; - Agent run execution (end-to-end)&lt;/div&gt;&lt;div&gt;&amp;nbsp; - Step-by-step processing&lt;/div&gt;&lt;div&gt;&amp;nbsp; - Tool invocations&lt;/div&gt;&lt;div&gt;&amp;nbsp; - Database queries&lt;/div&gt;&lt;div&gt;&amp;nbsp; - Job lifecycle (enqueue → execute → complete/fail/cancel)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="140" width="530" y="30" as="geometry" />
        </mxCell>
        <mxCell id="jL9Ayfw5SwNCbvacDRDm-108" edge="1" parent="1" source="jL9Ayfw5SwNCbvacDRDm-99" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=default;" target="jL9Ayfw5SwNCbvacDRDm-20">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="jL9Ayfw5SwNCbvacDRDm-99" parent="1" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#EAF7EA;strokeColor=default;" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;div&gt;&lt;b&gt;[&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;LONG-RUNNING JOB ENDPOINTS&lt;/span&gt;]&lt;/b&gt;&lt;/div&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="100" width="570" x="-690" y="1085" as="geometry" />
        </mxCell>
        <mxCell id="jL9Ayfw5SwNCbvacDRDm-100" parent="jL9Ayfw5SwNCbvacDRDm-99" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" value="&lt;div&gt;&lt;span style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;- POST /v1/jobs → HTTP 202 + Location header&lt;/span&gt;&lt;/div&gt;&lt;div&gt;- GET /v1/jobs/{id}&lt;/div&gt;&lt;div&gt;- GET /v1/jobs/{id}/events (SSE streaming)&lt;/div&gt;&lt;div&gt;- DELETE /v1/jobs/{id} (cancellation via Redis Lua script)&lt;/div&gt;" vertex="1">
          <mxGeometry height="70" width="570" y="30" as="geometry" />
        </mxCell>
        <mxCell id="jL9Ayfw5SwNCbvacDRDm-107" edge="1" parent="1" source="jL9Ayfw5SwNCbvacDRDm-20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=default;" target="jL9Ayfw5SwNCbvacDRDm-93">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="jL9Ayfw5SwNCbvacDRDm-20" parent="1" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#D7DEEB;strokeColor=default;" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;div&gt;&lt;b&gt;JOB CREATION &amp;amp; ENQUEUE&lt;/b&gt;&lt;/div&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="210" width="570" x="-690" y="1235" as="geometry" />
        </mxCell>
        <mxCell id="jL9Ayfw5SwNCbvacDRDm-21" parent="jL9Ayfw5SwNCbvacDRDm-20" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" value="&lt;div&gt;JOB CREATION FLOW:&lt;/div&gt;&lt;div&gt;- Validate job request (Pydantic schema)&lt;/div&gt;&lt;div&gt;- Validate payload against JSON Schema for job type&lt;/div&gt;&lt;div&gt;- Check idempotency key (Redis + PostgreSQL)&lt;/div&gt;&lt;div&gt;- Create Job record (status=queued) → PostgreSQL&lt;/div&gt;&lt;div&gt;- LPUSH job_id → Redis queue: jobs:queue:{type}&lt;/div&gt;&lt;div&gt;- HSET job state → Redis: jobs:state:{id}&lt;/div&gt;&lt;div&gt;- Cache idempotency mapping → Redis&lt;/div&gt;&lt;div&gt;- Return HTTP 202 + JobResponse {id, status, created_at} + Location header&lt;/div&gt;&lt;div&gt;- Job Types: demo, test, long-running, agent.run&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Redis Queue (Job IDs) → To Workers via BRPOP&lt;/div&gt;" vertex="1">
          <mxGeometry height="180" width="570" y="30" as="geometry" />
        </mxCell>
        <mxCell id="jL9Ayfw5SwNCbvacDRDm-106" edge="1" parent="1" source="jL9Ayfw5SwNCbvacDRDm-93" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeColor=default;" target="EiYPZZWAnG0CHaq9ObTb-5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="jL9Ayfw5SwNCbvacDRDm-93" parent="1" style="swimlane;whiteSpace=wrap;html=1;fillColor=#D6E4EB;strokeColor=default;" value="WORKERS" vertex="1">
          <mxGeometry height="710" width="570" x="-690" y="1495" as="geometry" />
        </mxCell>
        <mxCell id="jL9Ayfw5SwNCbvacDRDm-94" parent="jL9Ayfw5SwNCbvacDRDm-93" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#E9F7FF;strokeColor=default;" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;b&gt;SSE STREAMING TO CONTROL PANEL&lt;/b&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="90" width="550" x="10" y="610" as="geometry" />
        </mxCell>
        <mxCell id="jL9Ayfw5SwNCbvacDRDm-95" parent="jL9Ayfw5SwNCbvacDRDm-94" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" value="&lt;div&gt;- Control Panel subscribes: GET /v1/jobs/{id}/events (Server-Sent Events)&lt;/div&gt;&lt;div&gt;- Backend streams events from PostgreSQL + Redis buffer&lt;/div&gt;&lt;div&gt;- UI displays: real-time progress, logs, final status&lt;/div&gt;" vertex="1">
          <mxGeometry height="60" width="550" y="30" as="geometry" />
        </mxCell>
        <mxCell id="jL9Ayfw5SwNCbvacDRDm-96" parent="jL9Ayfw5SwNCbvacDRDm-93" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#E9F7FF;strokeColor=default;" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;b&gt;Job Processing Worker&lt;/b&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="560" width="550" x="10" y="40" as="geometry" />
        </mxCell>
        <mxCell id="jL9Ayfw5SwNCbvacDRDm-97" parent="jL9Ayfw5SwNCbvacDRDm-96" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" value="&lt;div&gt;WORKER PROCESSING LOOP FOR EACH JOB:&lt;/div&gt;&lt;div&gt;1. Pop job ID: BRPOP jobs:queue:{type} (blocking wait)&lt;/div&gt;&lt;div&gt;2. Load job metadata from PostgreSQL&lt;/div&gt;&lt;div&gt;3. Check pre-execution cancellation flag (Redis)&lt;/div&gt;&lt;div&gt;4. Update status: queued → running&lt;/div&gt;&lt;div&gt;5. Append status event to job_events table&lt;/div&gt;&lt;div&gt;6. Start async heartbeat task&lt;/div&gt;&lt;div&gt;7. Execute handler (uses same adapters: Memgraph, LLM, Redis):&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;- demo jobs: simple demonstration&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;- test jobs: testing purposes&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;- long-running jobs: extended analysis&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp;- agent.run jobs: async agent execution (orchestrator integration)&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;• Load/Create AgentRun record → PostgreSQL&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;• Update AgentRun status: queued → running&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;• Emit SSE: agent_run_started&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;• Initialize Orchestrator.from_env()&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;• Emit SSE: orchestrator_init&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;• Execute orchestrator.run() with timeout&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;• LLM calls, MCP tools, Graph queries&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;• Persist steps per-step → PostgreSQL&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;• Session state → Redis&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;• Check cancellation between steps&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;• Emit progress events per orchestration step&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;• Apply PII scrubbing &amp;amp; output guard&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;• Emit agent-specific Prometheus metrics&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp;• Update AgentRun status → succeeded | failed&lt;/div&gt;&lt;div&gt;8. Periodically check cancellation flags (Redis: jobs:cancel:{id})&lt;/div&gt;&lt;div&gt;9. Emit progress events → RPUSH jobs:events:{id} → SSE to Control Panel&lt;/div&gt;&lt;div&gt;10. On completion: status = finished | failed | cancelled&lt;/div&gt;&lt;div&gt;11. Persist result → PostgreSQL&lt;/div&gt;&lt;div&gt;12. Append terminal event to job_events&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Job Status State Machine: queued → running → finished | failed | cancelled&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Resources: 2 CPU, 4GB RAM&lt;/div&gt;&lt;div&gt;Uses same adapters/services as main app (shared codebase)&lt;/div&gt;" vertex="1">
          <mxGeometry height="530" width="550" y="30" as="geometry" />
        </mxCell>
        <mxCell id="jL9Ayfw5SwNCbvacDRDm-60" parent="1" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#DAE4E6;strokeColor=default;" value="&lt;div style=&quot;text-align: left;&quot;&gt;&lt;div&gt;&lt;b style=&quot;background-color: transparent; color: light-dark(rgb(0, 0, 0), rgb(255, 255, 255));&quot;&gt;PHASE 4)&amp;nbsp;&lt;/b&gt;&lt;b&gt;Long-Running Job Completion&lt;/b&gt;&lt;/div&gt;&lt;/div&gt;" vertex="1">
          <mxGeometry height="120" width="930" x="610" y="3045" as="geometry" />
        </mxCell>
        <mxCell id="jL9Ayfw5SwNCbvacDRDm-61" parent="jL9Ayfw5SwNCbvacDRDm-60" style="text;strokeColor=default;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" value="&lt;div&gt;- State machine: queued → running → finished | failed | cancelled&lt;/div&gt;&lt;div&gt;- Persist job status → PostgreSQL&lt;/div&gt;&lt;div&gt;- Append progress/state events → job_events table&lt;/div&gt;&lt;div&gt;- Progress event format: {stage, message, percent}&lt;/div&gt;&lt;div&gt;- Stream updates via SSE to Control Panel (heartbeat keep-alive)&lt;/div&gt;&lt;div&gt;- Emit and persist terminal status: finished | failed | cancelled&lt;/div&gt;" vertex="1">
          <mxGeometry height="90" width="930" y="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
